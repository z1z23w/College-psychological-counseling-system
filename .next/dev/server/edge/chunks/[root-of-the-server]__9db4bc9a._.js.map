{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/app/api/chat/route.ts"],"sourcesContent":["export const runtime = 'edge'; // 使用 Edge Runtime 获得更好的流式性能\r\n\r\nexport async function POST(req: Request) {\r\n  try {\r\n    // 1. 读取前端发来的消息\r\n    const { messages } = await req.json();\r\n\r\n    // 2. 准备请求头\r\n    const apiKey = process.env.SILICON_API_KEY;\r\n    if (!apiKey) {\r\n      return new Response(\"Error: 缺少 API Key\", { status: 500 });\r\n    }\r\n\r\n    // 3. 直接使用原生 fetch 请求硅基流动 (绝对不会错的地址)\r\n    const response = await fetch('https://api.siliconflow.cn/v1/chat/completions', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Bearer ${apiKey}`,\r\n      },\r\n      body: JSON.stringify({\r\n        model: 'Qwen/Qwen2.5-7B-Instruct', // 确保模型名字正确\r\n        messages: [\r\n          { role: 'system', content: '你是一个温柔的高校心理咨询助手\"小暖\"。请用温暖、共情的语气与同学交流。' },\r\n          ...messages\r\n        ],\r\n        stream: true, // 开启流式输出\r\n        temperature: 0.6,\r\n      }),\r\n    });\r\n\r\n    // 4. 检查上游是否报错\r\n    if (!response.ok) {\r\n      const errorText = await response.text();\r\n      console.error(\"SiliconCloud Error:\", errorText);\r\n      return new Response(`AI Provider Error: ${response.status} ${errorText}`, { status: response.status });\r\n    }\r\n\r\n    // 5. 直接转发流 (Pass-through)\r\n    // 这一步把 AI 的原始数据流直接扔给前端，效率最高\r\n    return new Response(response.body, {\r\n      headers: {\r\n        'Content-Type': 'text/event-stream',\r\n        'Cache-Control': 'no-cache',\r\n        'Connection': 'keep-alive',\r\n      },\r\n    });\r\n\r\n  } catch (error: any) {\r\n    console.error(\"Server Error:\", error);\r\n    return new Response(`Server Error: ${error.message}`, { status: 500 });\r\n  }\r\n}"],"names":[],"mappings":";;;;;;AAAO,MAAM,UAAU,QAAQ,4BAA4B;AAEpD,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,eAAe;QACf,MAAM,EAAE,QAAQ,EAAE,GAAG,MAAM,IAAI,IAAI;QAEnC,WAAW;QACX,MAAM,SAAS,QAAQ,GAAG,CAAC,eAAe;QAC1C,IAAI,CAAC,QAAQ;YACX,OAAO,IAAI,SAAS,qBAAqB;gBAAE,QAAQ;YAAI;QACzD;QAEA,oCAAoC;QACpC,MAAM,WAAW,MAAM,MAAM,kDAAkD;YAC7E,QAAQ;YACR,SAAS;gBACP,gBAAgB;gBAChB,iBAAiB,CAAC,OAAO,EAAE,QAAQ;YACrC;YACA,MAAM,KAAK,SAAS,CAAC;gBACnB,OAAO;gBACP,UAAU;oBACR;wBAAE,MAAM;wBAAU,SAAS;oBAAuC;uBAC/D;iBACJ;gBACD,QAAQ;gBACR,aAAa;YACf;QACF;QAEA,cAAc;QACd,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,YAAY,MAAM,SAAS,IAAI;YACrC,QAAQ,KAAK,CAAC,uBAAuB;YACrC,OAAO,IAAI,SAAS,CAAC,mBAAmB,EAAE,SAAS,MAAM,CAAC,CAAC,EAAE,WAAW,EAAE;gBAAE,QAAQ,SAAS,MAAM;YAAC;QACtG;QAEA,0BAA0B;QAC1B,4BAA4B;QAC5B,OAAO,IAAI,SAAS,SAAS,IAAI,EAAE;YACjC,SAAS;gBACP,gBAAgB;gBAChB,iBAAiB;gBACjB,cAAc;YAChB;QACF;IAEF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,iBAAiB;QAC/B,OAAO,IAAI,SAAS,CAAC,cAAc,EAAE,MAAM,OAAO,EAAE,EAAE;YAAE,QAAQ;QAAI;IACtE;AACF"}}]
}