{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///D:/%E8%BD%AF%E4%BB%B6%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E5%AE%9E%E9%AA%8C/my-counseling-app/app/api/chat/route.ts"],"sourcesContent":["export const maxDuration = 60; // 允许最长60秒超时\r\n\r\nexport async function POST(req: Request) {\r\n  try {\r\n    const { messages } = await req.json();\r\n    const apiKey = \"sk-orhmsgawpwhkkovvadvsgcsduzbvizntknaewcvfpvmraokm\";\r\n\r\n    if (!apiKey) {\r\n      return new Response(\"Error: 未找到 API Key，请检查 .env 文件\", { status: 500 });\r\n    }\r\n\r\n    // 1. 直接向硅基流动发起请求\r\n    const response = await fetch('https://api.siliconflow.com/v1/chat/completions', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Bearer ${apiKey}`,\r\n      },\r\n      body: JSON.stringify({\r\n        model: 'Qwen/Qwen2.5-7B-Instruct', // 确保模型名正确\r\n        messages: [\r\n          { role: 'system', content: '你是一个温柔的高校心理咨询助手\"小暖\"。' },\r\n          ...messages\r\n        ],\r\n        stream: true, // 开启流式\r\n        temperature: 0.6,\r\n      }),\r\n    });\r\n\r\n    // 2. 检查错误\r\n    if (!response.ok) {\r\n      const errorText = await response.text();\r\n      console.error(\"AI API Error:\", errorText);\r\n      return new Response(`API Error: ${response.status} - ${errorText}`, { status: response.status });\r\n    }\r\n\r\n    // 3. 直接透传流数据\r\n    return new Response(response.body, {\r\n      headers: {\r\n        'Content-Type': 'text/event-stream',\r\n        'Cache-Control': 'no-cache',\r\n        'Connection': 'keep-alive',\r\n      },\r\n    });\r\n\r\n  } catch (error: any) {\r\n    console.error(\"Server Error:\", error);\r\n    return new Response(`Internal Error: ${error.message}`, { status: 500 });\r\n  }\r\n}"],"names":[],"mappings":";;;;;;AAAO,MAAM,cAAc,IAAI,YAAY;AAEpC,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,EAAE,QAAQ,EAAE,GAAG,MAAM,IAAI,IAAI;QACnC,MAAM,SAAS;QAEf;;QAIA,iBAAiB;QACjB,MAAM,WAAW,MAAM,MAAM,mDAAmD;YAC9E,QAAQ;YACR,SAAS;gBACP,gBAAgB;gBAChB,iBAAiB,CAAC,OAAO,EAAE,QAAQ;YACrC;YACA,MAAM,KAAK,SAAS,CAAC;gBACnB,OAAO;gBACP,UAAU;oBACR;wBAAE,MAAM;wBAAU,SAAS;oBAAuB;uBAC/C;iBACJ;gBACD,QAAQ;gBACR,aAAa;YACf;QACF;QAEA,UAAU;QACV,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,YAAY,MAAM,SAAS,IAAI;YACrC,QAAQ,KAAK,CAAC,iBAAiB;YAC/B,OAAO,IAAI,SAAS,CAAC,WAAW,EAAE,SAAS,MAAM,CAAC,GAAG,EAAE,WAAW,EAAE;gBAAE,QAAQ,SAAS,MAAM;YAAC;QAChG;QAEA,aAAa;QACb,OAAO,IAAI,SAAS,SAAS,IAAI,EAAE;YACjC,SAAS;gBACP,gBAAgB;gBAChB,iBAAiB;gBACjB,cAAc;YAChB;QACF;IAEF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,iBAAiB;QAC/B,OAAO,IAAI,SAAS,CAAC,gBAAgB,EAAE,MAAM,OAAO,EAAE,EAAE;YAAE,QAAQ;QAAI;IACxE;AACF"}}]
}