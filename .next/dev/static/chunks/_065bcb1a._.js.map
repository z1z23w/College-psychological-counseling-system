{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/%E8%BD%AF%E4%BB%B6%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E5%AE%9E%E9%AA%8C/my-counseling-app/components/ui/progress.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Progress({\n  className,\n  value,\n  ...props\n}: React.ComponentProps<typeof ProgressPrimitive.Root>) {\n  return (\n    <ProgressPrimitive.Root\n      data-slot=\"progress\"\n      className={cn(\n        \"bg-primary/20 relative h-2 w-full overflow-hidden rounded-full\",\n        className\n      )}\n      {...props}\n    >\n      <ProgressPrimitive.Indicator\n        data-slot=\"progress-indicator\"\n        className=\"bg-primary h-full w-full flex-1 transition-all\"\n        style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n      />\n    </ProgressPrimitive.Root>\n  )\n}\n\nexport { Progress }\n"],"names":[],"mappings":";;;;;AAGA;AAEA;AALA;;;;AAOA,SAAS,SAAS,EAChB,SAAS,EACT,KAAK,EACL,GAAG,OACiD;IACpD,qBACE,6LAAC,+KAAsB;QACrB,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,kEACA;QAED,GAAG,KAAK;kBAET,cAAA,6LAAC,oLAA2B;YAC1B,aAAU;YACV,WAAU;YACV,OAAO;gBAAE,WAAW,CAAC,YAAY,EAAE,MAAM,CAAC,SAAS,CAAC,EAAE,EAAE,CAAC;YAAC;;;;;;;;;;;AAIlE;KArBS"}},
    {"offset": {"line": 48, "column": 0}, "map": {"version":3,"sources":["file:///D:/%E8%BD%AF%E4%BB%B6%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E5%AE%9E%E9%AA%8C/my-counseling-app/components/ui/card.tsx"],"sourcesContent":["import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Card({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card\"\n      className={cn(\n        \"bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-header\"\n      className={cn(\n        \"@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-title\"\n      className={cn(\"leading-none font-semibold\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardDescription({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-description\"\n      className={cn(\"text-muted-foreground text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardAction({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-action\"\n      className={cn(\n        \"col-start-2 row-span-2 row-start-1 self-start justify-self-end\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-content\"\n      className={cn(\"px-6\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-footer\"\n      className={cn(\"flex items-center px-6 [.border-t]:pt-6\", className)}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardAction,\n  CardDescription,\n  CardContent,\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAEA;;;AAEA,SAAS,KAAK,EAAE,SAAS,EAAE,GAAG,OAAoC;IAChE,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,qFACA;QAED,GAAG,KAAK;;;;;;AAGf;KAXS;AAaT,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,4JACA;QAED,GAAG,KAAK;;;;;;AAGf;MAXS;AAaT,SAAS,UAAU,EAAE,SAAS,EAAE,GAAG,OAAoC;IACrE,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EAAC,8BAA8B;QAC3C,GAAG,KAAK;;;;;;AAGf;MARS;AAUT,SAAS,gBAAgB,EAAE,SAAS,EAAE,GAAG,OAAoC;IAC3E,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGf;MARS;AAUT,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,kEACA;QAED,GAAG,KAAK;;;;;;AAGf;MAXS;AAaT,SAAS,YAAY,EAAE,SAAS,EAAE,GAAG,OAAoC;IACvE,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EAAC,QAAQ;QACrB,GAAG,KAAK;;;;;;AAGf;MARS;AAUT,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EAAC,2CAA2C;QACxD,GAAG,KAAK;;;;;;AAGf;MARS"}},
    {"offset": {"line": 168, "column": 0}, "map": {"version":3,"sources":["file:///D:/%E8%BD%AF%E4%BB%B6%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E5%AE%9E%E9%AA%8C/my-counseling-app/components/ui/alert.tsx"],"sourcesContent":["import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-card text-card-foreground\",\n        destructive:\n          \"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nfunction Alert({\n  className,\n  variant,\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof alertVariants>) {\n  return (\n    <div\n      data-slot=\"alert\"\n      role=\"alert\"\n      className={cn(alertVariants({ variant }), className)}\n      {...props}\n    />\n  )\n}\n\nfunction AlertTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"alert-title\"\n      className={cn(\n        \"col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction AlertDescription({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"alert-description\"\n      className={cn(\n        \"text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Alert, AlertTitle, AlertDescription }\n"],"names":[],"mappings":";;;;;;;;;AACA;AAEA;;;;AAEA,MAAM,gBAAgB,IAAA,0KAAG,EACvB,qOACA;IACE,UAAU;QACR,SAAS;YACP,SAAS;YACT,aACE;QACJ;IACF;IACA,iBAAiB;QACf,SAAS;IACX;AACF;AAGF,SAAS,MAAM,EACb,SAAS,EACT,OAAO,EACP,GAAG,OAC8D;IACjE,qBACE,6LAAC;QACC,aAAU;QACV,MAAK;QACL,WAAW,IAAA,qHAAE,EAAC,cAAc;YAAE;QAAQ,IAAI;QACzC,GAAG,KAAK;;;;;;AAGf;KAbS;AAeT,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,+DACA;QAED,GAAG,KAAK;;;;;;AAGf;MAXS;AAaT,SAAS,iBAAiB,EACxB,SAAS,EACT,GAAG,OACyB;IAC5B,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,kGACA;QAED,GAAG,KAAK;;;;;;AAGf;MAdS"}},
    {"offset": {"line": 244, "column": 0}, "map": {"version":3,"sources":["file:///D:/%E8%BD%AF%E4%BB%B6%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E5%AE%9E%E9%AA%8C/my-counseling-app/app/actions.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { prisma } from \"@/lib/db\";\r\nimport { revalidatePath } from \"next/cache\";\r\n\r\n// ==========================================\r\n// 1. ç”¨æˆ·ç®¡ç† (ç®¡ç†å‘˜ç”¨)\r\n// ==========================================\r\n\r\nexport async function getUsers() {\r\n  try {\r\n    const users = await prisma.user.findMany({\r\n      orderBy: { createdAt: 'desc' }\r\n    });\r\n    return { success: true, data: users };\r\n  } catch (error) {\r\n    console.error(\"è·å–ç”¨æˆ·å¤±è´¥:\", error);\r\n    return { success: false, data: [] };\r\n  }\r\n}\r\n\r\nexport async function createUser(formData: FormData) {\r\n  const name = formData.get(\"name\") as string;\r\n  const username = formData.get(\"username\") as string;\r\n  const role = formData.get(\"role\") as string;\r\n  const college = formData.get(\"college\") as string;\r\n\r\n  try {\r\n    await prisma.user.create({\r\n      data: {\r\n        name,\r\n        username,\r\n        role,\r\n        college,\r\n        password: \"123456\", // é»˜è®¤å¯†ç \r\n        avatar: `https://api.dicebear.com/7.x/avataaars/svg?seed=${name}`\r\n      },\r\n    });\r\n    revalidatePath(\"/admin/users\");\r\n    return { success: true };\r\n  } catch (error) {\r\n    return { success: false, error: \"åˆ›å»ºå¤±è´¥ï¼Œå­¦å·å¯èƒ½å·²å­˜åœ¨\" };\r\n  }\r\n}\r\n\r\nexport async function updateUser(id: string, formData: FormData) {\r\n  const name = formData.get(\"name\") as string;\r\n  const username = formData.get(\"username\") as string;\r\n  const role = formData.get(\"role\") as string;\r\n  const college = formData.get(\"college\") as string;\r\n\r\n  try {\r\n    await prisma.user.update({\r\n      where: { id },\r\n      data: { name, username, role, college },\r\n    });\r\n    revalidatePath(\"/admin/users\");\r\n    return { success: true };\r\n  } catch (error) {\r\n    return { success: false, error: \"æ›´æ–°å¤±è´¥ï¼Œå­¦å·å¯èƒ½å†²çª\" };\r\n  }\r\n}\r\n\r\nexport async function deleteUser(id: string) {\r\n  try {\r\n    await prisma.user.delete({ where: { id } });\r\n    revalidatePath(\"/admin/users\");\r\n    return { success: true };\r\n  } catch (error) {\r\n    return { success: false, error: \"åˆ é™¤å¤±è´¥\" };\r\n  }\r\n}\r\n\r\n// ==========================================\r\n// 2. è®¤è¯ä¸æŸ¥è¯¢ (é€šç”¨)\r\n// ==========================================\r\n\r\nexport async function loginAction(username: string, role: string) {\r\n  try {\r\n    const user = await prisma.user.findFirst({\r\n      where: { username, role }\r\n    });\r\n    if (!user) return { success: false, error: \"ç”¨æˆ·ä¸å­˜åœ¨æˆ–è§’è‰²é”™è¯¯\" };\r\n    \r\n    // è¿”å›ç”¨æˆ·ä¿¡æ¯ï¼ˆä¸å«å¯†ç ï¼‰\r\n    const { password, ...userInfo } = user;\r\n    return { success: true, data: userInfo };\r\n  } catch (error) {\r\n    return { success: false, error: \"æ•°æ®åº“è¿æ¥å¤±è´¥\" };\r\n  }\r\n}\r\n\r\nexport async function getCounselors() {\r\n  return await prisma.user.findMany({\r\n    where: { role: 'counselor' },\r\n    select: { id: true, name: true, college: true, avatar: true } // æ˜ç¡®é€‰æ‹©éœ€è¦çš„å­—æ®µ\r\n  });\r\n}\r\n\r\n// ==========================================\r\n// 3. é¢„çº¦ç³»ç»Ÿ (æ ¸å¿ƒä¸šåŠ¡)\r\n// ==========================================\r\n\r\n// âœ… ä¿®å¤ï¼šè·å–é¢„çº¦åˆ—è¡¨ (å»é™¤äº† email å­—æ®µ)\r\nexport async function getAppointments(userId: string, role: 'student' | 'counselor') {\r\n  const where = role === 'student' ? { studentId: userId } : { counselorId: userId };\r\n  \r\n  const data = await prisma.appointment.findMany({\r\n    where,\r\n    include: {\r\n      // âš ï¸ å…³é”®ä¿®æ”¹ï¼šUserè¡¨æ²¡æœ‰emailå­—æ®µï¼Œæ”¹æŸ¥ username(å­¦å·) å’Œ college\r\n      student: { select: { name: true, username: true, college: true, avatar: true } },\r\n      counselor: { select: { name: true, college: true, avatar: true } },\r\n      testResult: true, // è·å–å…³è”çš„æµ‹è¯„ç»“æœ\r\n    },\r\n    orderBy: { date: 'desc' }\r\n  });\r\n  return data;\r\n}\r\n\r\n// âœ… åˆ›å»ºå¸¦è¯¦ç»†æ¡£æ¡ˆçš„é¢„çº¦\r\nexport async function createAppointmentWithDetails(data: any) {\r\n  // æ£€æŸ¥æ—¶é—´å†²çª\r\n  const existing = await prisma.appointment.findFirst({\r\n    where: {\r\n      counselorId: data.counselorId,\r\n      date: new Date(data.date),\r\n      time: data.time,\r\n      status: 'confirmed' \r\n    }\r\n  });\r\n\r\n  if (existing) return { success: false, msg: \"è¯¥æ—¶æ®µå·²è¢«å ç”¨\" };\r\n\r\n  try {\r\n    await prisma.appointment.create({\r\n      data: {\r\n        studentId: data.studentId,\r\n        counselorId: data.counselorId,\r\n        date: new Date(data.date),\r\n        time: data.time,\r\n        // è¯¦ç»†ä¿¡æ¯\r\n        idCard: data.idCard,\r\n        studentIdNum: data.studentIdNum,\r\n        phone: data.phone,\r\n        college: data.college,\r\n        major: data.major,\r\n        grade: data.grade,\r\n        classInfo: data.classInfo,\r\n        mentalHistory: data.mentalHistory,\r\n        physicalState: data.physicalState,\r\n        problemType: data.problemType,\r\n        status: 'pending'\r\n      }\r\n    });\r\n\r\n    revalidatePath('/student/booking');\r\n    revalidatePath('/counselor/dashboard');\r\n    return { success: true };\r\n  } catch (e) {\r\n    console.error(e);\r\n    return { success: false, msg: \"é¢„çº¦åˆ›å»ºå¼‚å¸¸\" };\r\n  }\r\n}\r\n\r\n// æ›´æ–°é¢„çº¦çŠ¶æ€ (å®¡æ‰¹/æ‹’ç»/å®Œæˆ)\r\nexport async function updateAppointmentStatus(id: string, status: string) {\r\n  await prisma.appointment.update({\r\n    where: { id },\r\n    data: { status }\r\n  });\r\n  revalidatePath(\"/counselor/dashboard\");\r\n  revalidatePath(\"/student/booking\");\r\n  return { success: true };\r\n}\r\n\r\n// æ›´æ–°å’¨è¯¢è®°å½• (å’¨è¯¢å¸ˆå†™ç»“æ¡ˆè®°å½•)\r\n// app/actions.ts\r\n\r\nexport async function updateConsultationRecord(id: string, notes: string) {\r\n  try {\r\n    await prisma.appointment.update({\r\n      where: { id },\r\n      data: { \r\n        notes, \r\n        status: 'completed' \r\n      }\r\n    });\r\n    revalidatePath(\"/counselor/dashboard\");\r\n    revalidatePath(\"/counselor/cases\"); // ç¡®ä¿åˆ·æ–°æ¡£æ¡ˆé¡µé¢\r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error(\"ä¿å­˜å’¨è¯¢è®°å½•å¤±è´¥:\", error); // æ‰“å°é”™è¯¯æ—¥å¿—æ–¹ä¾¿æ’æŸ¥\r\n    return { success: false, error: \"ä¿å­˜å¤±è´¥\" };\r\n  }\r\n}\r\n\r\n// ==========================================\r\n// 4. å¿ƒç†æµ‹è¯„ç³»ç»Ÿ (TestResult)\r\n// ==========================================\r\n\r\nexport async function submitPsychTest(appointmentId: string, answers: any) {\r\n  // 1. è®¡ç®—åˆ†æ•°\r\n  const calculateScore = (arr: number[]) => arr.reduce((a, b) => a + b, 0);\r\n  const sdsScore = calculateScore(answers.sds || []);\r\n  const sasScore = calculateScore(answers.sas || []);\r\n  const sesScore = calculateScore(answers.ses || []);\r\n\r\n  // 2. é¢„è­¦åˆ¤æ–­ (é˜ˆå€¼ > 60)\r\n  let isHighRisk = false;\r\n  \r\n  if (sdsScore > 60 || sasScore > 60) {\r\n    isHighRisk = true;\r\n  }\r\n\r\n  try {\r\n    // 3. ä¿å­˜æµ‹è¯„ç»“æœ\r\n    await prisma.testResult.create({\r\n      data: {\r\n        appointmentId,\r\n        rawAnswers: answers,\r\n        sdsScore,\r\n        sasScore,\r\n        sesScore\r\n      }\r\n    });\r\n\r\n    // 4. å¦‚æœæ˜¯é«˜é£é™©ï¼Œä»…åšæ ‡è®°\r\n    if (isHighRisk) {\r\n        // A. æ ‡è®°å½“å‰é¢„çº¦ä¸ºå±æœº\r\n        await prisma.appointment.update({\r\n            where: { id: appointmentId },\r\n            data: { isCrisis: true }\r\n        });\r\n\r\n        // B. æ ‡è®°å­¦ç”Ÿæ¡£æ¡ˆä¸ºçº¢è‰²é¢„è­¦\r\n        const currentApt = await prisma.appointment.findUnique({ where: { id: appointmentId } });\r\n        if (currentApt) {\r\n            await prisma.user.update({\r\n                where: { id: currentApt.studentId },\r\n                data: { riskLevel: 'red' }\r\n            });\r\n        }\r\n    }\r\n\r\n    revalidatePath('/student/booking');\r\n    revalidatePath('/counselor/dashboard');\r\n    \r\n    // âœ… ç§»é™¤è‡ªåŠ¨é¢„çº¦ä»£ç ï¼Œä»…è¿”å›é£é™©çŠ¶æ€\r\n    return { success: true, isHighRisk };\r\n\r\n  } catch (error) {\r\n    console.error(\"æµ‹è¯„æäº¤å¤±è´¥:\", error);\r\n    return { success: false, error: \"æäº¤å¤±è´¥\" };\r\n  }\r\n}\r\n\r\n// ==========================================\r\n// 5. æ’ç­ç³»ç»Ÿ (Schedule)\r\n// ==========================================\r\n\r\nexport async function getCounselorSchedule(counselorId: string) {\r\n  try {\r\n    const schedules = await prisma.schedule.findMany({\r\n      where: { counselorId, isAvailable: true }\r\n    });\r\n    return { success: true, data: schedules };\r\n  } catch (error) {\r\n    return { success: false, data: [] };\r\n  }\r\n}\r\n\r\nexport async function updateSchedule(counselorId: string, slots: any[]) {\r\n  try {\r\n    const ops = slots.map(slot => \r\n      prisma.schedule.upsert({\r\n        where: {\r\n          counselorId_dayOfWeek_timeSlot: {\r\n            counselorId,\r\n            dayOfWeek: slot.dayOfWeek,\r\n            timeSlot: slot.timeSlot\r\n          }\r\n        },\r\n        update: { isAvailable: slot.isAvailable },\r\n        create: {\r\n          counselorId,\r\n          dayOfWeek: slot.dayOfWeek,\r\n          timeSlot: slot.timeSlot,\r\n          isAvailable: slot.isAvailable\r\n        }\r\n      })\r\n    );\r\n    \r\n    await prisma.$transaction(ops);\r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error(error);\r\n    return { success: false, error: \"ä¿å­˜å¤±è´¥\" };\r\n  }\r\n}\r\n\r\n// ==========================================\r\n// 6. èŠå¤©ç³»ç»Ÿ (Messages)\r\n// ==========================================\r\n\r\nexport async function getChatContacts(currentUserId: string, role: string) {\r\n  try {\r\n    if (role === 'student') {\r\n      const counselors = await prisma.user.findMany({\r\n        where: { role: 'counselor' },\r\n        select: { id: true, name: true, avatar: true, college: true }\r\n      });\r\n      return { success: true, data: counselors };\r\n    } else {\r\n      const students = await prisma.user.findMany({\r\n        where: { role: 'student' },\r\n        select: { id: true, name: true, avatar: true, college: true }\r\n      });\r\n      return { success: true, data: students };\r\n    }\r\n  } catch (error) {\r\n    return { success: false, data: [] };\r\n  }\r\n}\r\n\r\nexport async function getMessages(userId1: string, userId2: string) {\r\n  try {\r\n    const messages = await prisma.message.findMany({\r\n      where: {\r\n        OR: [\r\n          { senderId: userId1, receiverId: userId2 },\r\n          { senderId: userId2, receiverId: userId1 }\r\n        ]\r\n      },\r\n      orderBy: { createdAt: 'asc' },\r\n      include: {\r\n        sender: { select: { name: true, avatar: true } }\r\n      }\r\n    });\r\n    return { success: true, data: messages };\r\n  } catch (error) {\r\n    return { success: false, data: [] };\r\n  }\r\n}\r\n\r\nexport async function sendMessage(senderId: string, receiverId: string, content: string) {\r\n  try {\r\n    const message = await prisma.message.create({\r\n      data: { senderId, receiverId, content }\r\n    });\r\n    return { success: true, data: message };\r\n  } catch (error) {\r\n    return { success: false, error: \"å‘é€å¤±è´¥\" };\r\n  }\r\n}\r\n\r\n// ==========================================\r\n// 7. æ–‡ç« ç³»ç»Ÿ (Articles)\r\n// ==========================================\r\n\r\nexport async function getArticles() {\r\n  const articles = await prisma.article.findMany({\r\n    orderBy: { createdAt: 'desc' }\r\n  });\r\n  return articles.map(a => ({\r\n    ...a,\r\n    createdAt: a.createdAt.toISOString()\r\n  }));\r\n}\r\n\r\nexport async function getArticleById(id: string) {\r\n  try {\r\n    const article = await prisma.article.findUnique({ where: { id } });\r\n    if (article) return { success: true, data: article };\r\n    return { success: false, error: \"æ–‡ç« æœªæ‰¾åˆ°\" };\r\n  } catch (error) {\r\n    return { success: false, error: \"æŸ¥è¯¢å¤±è´¥\" };\r\n  }\r\n}\r\n\r\nexport async function createArticle(data: any) {\r\n  await prisma.article.create({\r\n    data: {\r\n      ...data,\r\n      author: 'ç®¡ç†å‘˜',\r\n      views: 0,\r\n      image: \"https://images.unsplash.com/photo-1499209974431-2761eb43a768?w=800&q=80\"\r\n    }\r\n  });\r\n  revalidatePath(\"/student/articles\");\r\n  revalidatePath(\"/admin/content\");\r\n  return { success: true };\r\n}\r\n\r\nexport async function deleteArticle(id: string) {\r\n  try {\r\n    await prisma.article.delete({ where: { id } });\r\n    revalidatePath(\"/admin/content\");\r\n    revalidatePath(\"/student/articles\");\r\n    return { success: true };\r\n  } catch (error) {\r\n    return { success: false, error: \"åˆ é™¤å¤±è´¥\" };\r\n  }\r\n}\r\n\r\n// ==========================================\r\n// 8. ç³»ç»Ÿç®¡ç†ä¸çœ‹æ¿\r\n// ==========================================\r\n\r\nexport async function getAdminDashboardStats() {\r\n  try {\r\n    const [studentCount, appointmentCount, completedCount, rawChartData] = await Promise.all([\r\n      prisma.user.count({ where: { role: 'student' } }),\r\n      \r\n      // ç»Ÿè®¡æ‰€æœ‰é¢„çº¦ (åŒ…æ‹¬ç­‰å¾…ä¸­çš„ï¼Œç”¨äºæ˜¾ç¤ºçƒ­åº¦)\r\n      prisma.appointment.count(), \r\n\r\n      // ç»Ÿè®¡å·²å®Œæˆ\r\n      prisma.appointment.count({ where: { status: 'completed' } }),\r\n\r\n      // å›¾è¡¨æ•°æ® (ç»Ÿè®¡æœ€è¿‘7å¤©)\r\n      prisma.appointment.findMany({\r\n        where: {\r\n          date: { gte: new Date(new Date().setDate(new Date().getDate() - 6)) }\r\n        },\r\n        select: { date: true }\r\n      })\r\n    ]);\r\n\r\n    const completionRate = appointmentCount > 0 \r\n      ? Math.round((completedCount / appointmentCount) * 100) + \"%\" \r\n      : \"0%\";\r\n\r\n    const chartData = [];\r\n    const weekMap = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];\r\n\r\n    for (let i = 6; i >= 0; i--) {\r\n      const d = new Date();\r\n      d.setDate(d.getDate() - i);\r\n      const month = d.getMonth() + 1;\r\n      const day = d.getDate();\r\n      const dateKey = `${month}/${day}`;\r\n      const weekLabel = weekMap[d.getDay()];\r\n\r\n      const count = rawChartData.filter(apt => {\r\n        const aptDate = new Date(apt.date);\r\n        return aptDate.getDate() === day && aptDate.getMonth() + 1 === month;\r\n      }).length;\r\n\r\n      chartData.push({ name: dateKey, day: weekLabel, visits: count });\r\n    }\r\n\r\n    return {\r\n      success: true,\r\n      data: {\r\n        stats: {\r\n          students: studentCount,\r\n          appointments: appointmentCount,\r\n          crisis: 0, // æš‚æ— å±æœºé¢„è­¦é€»è¾‘\r\n          rate: completionRate\r\n        },\r\n        chart: chartData\r\n      }\r\n    };\r\n\r\n  } catch (error) {\r\n    console.error(\"çœ‹æ¿æ•°æ®åŠ è½½å¤±è´¥:\", error);\r\n    return { success: false, error: \"åŠ è½½å¤±è´¥\" };\r\n  }\r\n}\r\n\r\nexport async function getSystemSettings() {\r\n  try {\r\n    let config = await prisma.systemConfig.findFirst();\r\n    if (!config) {\r\n      config = await prisma.systemConfig.create({ data: {} });\r\n    }\r\n    return { success: true, data: config };\r\n  } catch (error) {\r\n    return { success: false, error: \"è·å–é…ç½®å¤±è´¥\" };\r\n  }\r\n}\r\n\r\nexport async function updateSystemSettings(data: any) {\r\n  try {\r\n    const first = await prisma.systemConfig.findFirst();\r\n    if (first) {\r\n      await prisma.systemConfig.update({\r\n        where: { id: first.id },\r\n        data: {\r\n          platformName: data.platformName,\r\n          hotline: data.hotline,\r\n          openHours: data.openHours,\r\n          maintenanceMode: data.maintenanceMode === 'true' || data.maintenanceMode === true\r\n        }\r\n      });\r\n      return { success: true };\r\n    }\r\n    return { success: false, error: \"æœªæ‰¾åˆ°é…ç½®è®°å½•\" };\r\n  } catch (error) {\r\n    return { success: false, error: \"ä¿å­˜å¤±è´¥\" };\r\n  }\r\n}\r\n\r\n// ä¿å­˜è‡ªåŠ©æµ‹è¯„ç»“æœ\r\nexport async function saveAssessment(studentId: string, score: number, result: string) {\r\n  try {\r\n    // æ³¨æ„ï¼šè¿™é‡Œä½¿ç”¨çš„æ˜¯ Assessment è¡¨ï¼Œä¸æ˜¯ TestResult è¡¨\r\n    await prisma.assessment.create({\r\n      data: {\r\n        studentId,\r\n        type: 'PHQ-9', // é»˜è®¤ç±»å‹\r\n        score,\r\n        result\r\n      }\r\n    });\r\n    revalidatePath(\"/student/assessment\");\r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error(\"ä¿å­˜æµ‹è¯„å¤±è´¥:\", error);\r\n    return { success: false, error: \"ä¿å­˜å¤±è´¥\" };\r\n  }\r\n}\r\n\r\n// è·å–å†å²æµ‹è¯„è®°å½• (ç”¨äºç”»å›¾)\r\nexport async function getAssessmentHistory(studentId: string) {\r\n  try {\r\n    const data = await prisma.assessment.findMany({\r\n      where: { studentId },\r\n      orderBy: { createdAt: 'asc' } // æŒ‰æ—¶é—´æ­£åºæ’åˆ—ï¼Œæ–¹ä¾¿å›¾è¡¨æ˜¾ç¤ºè¶‹åŠ¿\r\n    });\r\n    return data;\r\n  } catch (error) {\r\n    console.error(\"è·å–å†å²å¤±è´¥:\", error);\r\n    return [];\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;IAyfsB,iBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 259, "column": 0}, "map": {"version":3,"sources":["file:///D:/%E8%BD%AF%E4%BB%B6%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E5%AE%9E%E9%AA%8C/my-counseling-app/app/actions.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { prisma } from \"@/lib/db\";\r\nimport { revalidatePath } from \"next/cache\";\r\n\r\n// ==========================================\r\n// 1. ç”¨æˆ·ç®¡ç† (ç®¡ç†å‘˜ç”¨)\r\n// ==========================================\r\n\r\nexport async function getUsers() {\r\n  try {\r\n    const users = await prisma.user.findMany({\r\n      orderBy: { createdAt: 'desc' }\r\n    });\r\n    return { success: true, data: users };\r\n  } catch (error) {\r\n    console.error(\"è·å–ç”¨æˆ·å¤±è´¥:\", error);\r\n    return { success: false, data: [] };\r\n  }\r\n}\r\n\r\nexport async function createUser(formData: FormData) {\r\n  const name = formData.get(\"name\") as string;\r\n  const username = formData.get(\"username\") as string;\r\n  const role = formData.get(\"role\") as string;\r\n  const college = formData.get(\"college\") as string;\r\n\r\n  try {\r\n    await prisma.user.create({\r\n      data: {\r\n        name,\r\n        username,\r\n        role,\r\n        college,\r\n        password: \"123456\", // é»˜è®¤å¯†ç \r\n        avatar: `https://api.dicebear.com/7.x/avataaars/svg?seed=${name}`\r\n      },\r\n    });\r\n    revalidatePath(\"/admin/users\");\r\n    return { success: true };\r\n  } catch (error) {\r\n    return { success: false, error: \"åˆ›å»ºå¤±è´¥ï¼Œå­¦å·å¯èƒ½å·²å­˜åœ¨\" };\r\n  }\r\n}\r\n\r\nexport async function updateUser(id: string, formData: FormData) {\r\n  const name = formData.get(\"name\") as string;\r\n  const username = formData.get(\"username\") as string;\r\n  const role = formData.get(\"role\") as string;\r\n  const college = formData.get(\"college\") as string;\r\n\r\n  try {\r\n    await prisma.user.update({\r\n      where: { id },\r\n      data: { name, username, role, college },\r\n    });\r\n    revalidatePath(\"/admin/users\");\r\n    return { success: true };\r\n  } catch (error) {\r\n    return { success: false, error: \"æ›´æ–°å¤±è´¥ï¼Œå­¦å·å¯èƒ½å†²çª\" };\r\n  }\r\n}\r\n\r\nexport async function deleteUser(id: string) {\r\n  try {\r\n    await prisma.user.delete({ where: { id } });\r\n    revalidatePath(\"/admin/users\");\r\n    return { success: true };\r\n  } catch (error) {\r\n    return { success: false, error: \"åˆ é™¤å¤±è´¥\" };\r\n  }\r\n}\r\n\r\n// ==========================================\r\n// 2. è®¤è¯ä¸æŸ¥è¯¢ (é€šç”¨)\r\n// ==========================================\r\n\r\nexport async function loginAction(username: string, role: string) {\r\n  try {\r\n    const user = await prisma.user.findFirst({\r\n      where: { username, role }\r\n    });\r\n    if (!user) return { success: false, error: \"ç”¨æˆ·ä¸å­˜åœ¨æˆ–è§’è‰²é”™è¯¯\" };\r\n    \r\n    // è¿”å›ç”¨æˆ·ä¿¡æ¯ï¼ˆä¸å«å¯†ç ï¼‰\r\n    const { password, ...userInfo } = user;\r\n    return { success: true, data: userInfo };\r\n  } catch (error) {\r\n    return { success: false, error: \"æ•°æ®åº“è¿æ¥å¤±è´¥\" };\r\n  }\r\n}\r\n\r\nexport async function getCounselors() {\r\n  return await prisma.user.findMany({\r\n    where: { role: 'counselor' },\r\n    select: { id: true, name: true, college: true, avatar: true } // æ˜ç¡®é€‰æ‹©éœ€è¦çš„å­—æ®µ\r\n  });\r\n}\r\n\r\n// ==========================================\r\n// 3. é¢„çº¦ç³»ç»Ÿ (æ ¸å¿ƒä¸šåŠ¡)\r\n// ==========================================\r\n\r\n// âœ… ä¿®å¤ï¼šè·å–é¢„çº¦åˆ—è¡¨ (å»é™¤äº† email å­—æ®µ)\r\nexport async function getAppointments(userId: string, role: 'student' | 'counselor') {\r\n  const where = role === 'student' ? { studentId: userId } : { counselorId: userId };\r\n  \r\n  const data = await prisma.appointment.findMany({\r\n    where,\r\n    include: {\r\n      // âš ï¸ å…³é”®ä¿®æ”¹ï¼šUserè¡¨æ²¡æœ‰emailå­—æ®µï¼Œæ”¹æŸ¥ username(å­¦å·) å’Œ college\r\n      student: { select: { name: true, username: true, college: true, avatar: true } },\r\n      counselor: { select: { name: true, college: true, avatar: true } },\r\n      testResult: true, // è·å–å…³è”çš„æµ‹è¯„ç»“æœ\r\n    },\r\n    orderBy: { date: 'desc' }\r\n  });\r\n  return data;\r\n}\r\n\r\n// âœ… åˆ›å»ºå¸¦è¯¦ç»†æ¡£æ¡ˆçš„é¢„çº¦\r\nexport async function createAppointmentWithDetails(data: any) {\r\n  // æ£€æŸ¥æ—¶é—´å†²çª\r\n  const existing = await prisma.appointment.findFirst({\r\n    where: {\r\n      counselorId: data.counselorId,\r\n      date: new Date(data.date),\r\n      time: data.time,\r\n      status: 'confirmed' \r\n    }\r\n  });\r\n\r\n  if (existing) return { success: false, msg: \"è¯¥æ—¶æ®µå·²è¢«å ç”¨\" };\r\n\r\n  try {\r\n    await prisma.appointment.create({\r\n      data: {\r\n        studentId: data.studentId,\r\n        counselorId: data.counselorId,\r\n        date: new Date(data.date),\r\n        time: data.time,\r\n        // è¯¦ç»†ä¿¡æ¯\r\n        idCard: data.idCard,\r\n        studentIdNum: data.studentIdNum,\r\n        phone: data.phone,\r\n        college: data.college,\r\n        major: data.major,\r\n        grade: data.grade,\r\n        classInfo: data.classInfo,\r\n        mentalHistory: data.mentalHistory,\r\n        physicalState: data.physicalState,\r\n        problemType: data.problemType,\r\n        status: 'pending'\r\n      }\r\n    });\r\n\r\n    revalidatePath('/student/booking');\r\n    revalidatePath('/counselor/dashboard');\r\n    return { success: true };\r\n  } catch (e) {\r\n    console.error(e);\r\n    return { success: false, msg: \"é¢„çº¦åˆ›å»ºå¼‚å¸¸\" };\r\n  }\r\n}\r\n\r\n// æ›´æ–°é¢„çº¦çŠ¶æ€ (å®¡æ‰¹/æ‹’ç»/å®Œæˆ)\r\nexport async function updateAppointmentStatus(id: string, status: string) {\r\n  await prisma.appointment.update({\r\n    where: { id },\r\n    data: { status }\r\n  });\r\n  revalidatePath(\"/counselor/dashboard\");\r\n  revalidatePath(\"/student/booking\");\r\n  return { success: true };\r\n}\r\n\r\n// æ›´æ–°å’¨è¯¢è®°å½• (å’¨è¯¢å¸ˆå†™ç»“æ¡ˆè®°å½•)\r\n// app/actions.ts\r\n\r\nexport async function updateConsultationRecord(id: string, notes: string) {\r\n  try {\r\n    await prisma.appointment.update({\r\n      where: { id },\r\n      data: { \r\n        notes, \r\n        status: 'completed' \r\n      }\r\n    });\r\n    revalidatePath(\"/counselor/dashboard\");\r\n    revalidatePath(\"/counselor/cases\"); // ç¡®ä¿åˆ·æ–°æ¡£æ¡ˆé¡µé¢\r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error(\"ä¿å­˜å’¨è¯¢è®°å½•å¤±è´¥:\", error); // æ‰“å°é”™è¯¯æ—¥å¿—æ–¹ä¾¿æ’æŸ¥\r\n    return { success: false, error: \"ä¿å­˜å¤±è´¥\" };\r\n  }\r\n}\r\n\r\n// ==========================================\r\n// 4. å¿ƒç†æµ‹è¯„ç³»ç»Ÿ (TestResult)\r\n// ==========================================\r\n\r\nexport async function submitPsychTest(appointmentId: string, answers: any) {\r\n  // 1. è®¡ç®—åˆ†æ•°\r\n  const calculateScore = (arr: number[]) => arr.reduce((a, b) => a + b, 0);\r\n  const sdsScore = calculateScore(answers.sds || []);\r\n  const sasScore = calculateScore(answers.sas || []);\r\n  const sesScore = calculateScore(answers.ses || []);\r\n\r\n  // 2. é¢„è­¦åˆ¤æ–­ (é˜ˆå€¼ > 60)\r\n  let isHighRisk = false;\r\n  \r\n  if (sdsScore > 60 || sasScore > 60) {\r\n    isHighRisk = true;\r\n  }\r\n\r\n  try {\r\n    // 3. ä¿å­˜æµ‹è¯„ç»“æœ\r\n    await prisma.testResult.create({\r\n      data: {\r\n        appointmentId,\r\n        rawAnswers: answers,\r\n        sdsScore,\r\n        sasScore,\r\n        sesScore\r\n      }\r\n    });\r\n\r\n    // 4. å¦‚æœæ˜¯é«˜é£é™©ï¼Œä»…åšæ ‡è®°\r\n    if (isHighRisk) {\r\n        // A. æ ‡è®°å½“å‰é¢„çº¦ä¸ºå±æœº\r\n        await prisma.appointment.update({\r\n            where: { id: appointmentId },\r\n            data: { isCrisis: true }\r\n        });\r\n\r\n        // B. æ ‡è®°å­¦ç”Ÿæ¡£æ¡ˆä¸ºçº¢è‰²é¢„è­¦\r\n        const currentApt = await prisma.appointment.findUnique({ where: { id: appointmentId } });\r\n        if (currentApt) {\r\n            await prisma.user.update({\r\n                where: { id: currentApt.studentId },\r\n                data: { riskLevel: 'red' }\r\n            });\r\n        }\r\n    }\r\n\r\n    revalidatePath('/student/booking');\r\n    revalidatePath('/counselor/dashboard');\r\n    \r\n    // âœ… ç§»é™¤è‡ªåŠ¨é¢„çº¦ä»£ç ï¼Œä»…è¿”å›é£é™©çŠ¶æ€\r\n    return { success: true, isHighRisk };\r\n\r\n  } catch (error) {\r\n    console.error(\"æµ‹è¯„æäº¤å¤±è´¥:\", error);\r\n    return { success: false, error: \"æäº¤å¤±è´¥\" };\r\n  }\r\n}\r\n\r\n// ==========================================\r\n// 5. æ’ç­ç³»ç»Ÿ (Schedule)\r\n// ==========================================\r\n\r\nexport async function getCounselorSchedule(counselorId: string) {\r\n  try {\r\n    const schedules = await prisma.schedule.findMany({\r\n      where: { counselorId, isAvailable: true }\r\n    });\r\n    return { success: true, data: schedules };\r\n  } catch (error) {\r\n    return { success: false, data: [] };\r\n  }\r\n}\r\n\r\nexport async function updateSchedule(counselorId: string, slots: any[]) {\r\n  try {\r\n    const ops = slots.map(slot => \r\n      prisma.schedule.upsert({\r\n        where: {\r\n          counselorId_dayOfWeek_timeSlot: {\r\n            counselorId,\r\n            dayOfWeek: slot.dayOfWeek,\r\n            timeSlot: slot.timeSlot\r\n          }\r\n        },\r\n        update: { isAvailable: slot.isAvailable },\r\n        create: {\r\n          counselorId,\r\n          dayOfWeek: slot.dayOfWeek,\r\n          timeSlot: slot.timeSlot,\r\n          isAvailable: slot.isAvailable\r\n        }\r\n      })\r\n    );\r\n    \r\n    await prisma.$transaction(ops);\r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error(error);\r\n    return { success: false, error: \"ä¿å­˜å¤±è´¥\" };\r\n  }\r\n}\r\n\r\n// ==========================================\r\n// 6. èŠå¤©ç³»ç»Ÿ (Messages)\r\n// ==========================================\r\n\r\nexport async function getChatContacts(currentUserId: string, role: string) {\r\n  try {\r\n    if (role === 'student') {\r\n      const counselors = await prisma.user.findMany({\r\n        where: { role: 'counselor' },\r\n        select: { id: true, name: true, avatar: true, college: true }\r\n      });\r\n      return { success: true, data: counselors };\r\n    } else {\r\n      const students = await prisma.user.findMany({\r\n        where: { role: 'student' },\r\n        select: { id: true, name: true, avatar: true, college: true }\r\n      });\r\n      return { success: true, data: students };\r\n    }\r\n  } catch (error) {\r\n    return { success: false, data: [] };\r\n  }\r\n}\r\n\r\nexport async function getMessages(userId1: string, userId2: string) {\r\n  try {\r\n    const messages = await prisma.message.findMany({\r\n      where: {\r\n        OR: [\r\n          { senderId: userId1, receiverId: userId2 },\r\n          { senderId: userId2, receiverId: userId1 }\r\n        ]\r\n      },\r\n      orderBy: { createdAt: 'asc' },\r\n      include: {\r\n        sender: { select: { name: true, avatar: true } }\r\n      }\r\n    });\r\n    return { success: true, data: messages };\r\n  } catch (error) {\r\n    return { success: false, data: [] };\r\n  }\r\n}\r\n\r\nexport async function sendMessage(senderId: string, receiverId: string, content: string) {\r\n  try {\r\n    const message = await prisma.message.create({\r\n      data: { senderId, receiverId, content }\r\n    });\r\n    return { success: true, data: message };\r\n  } catch (error) {\r\n    return { success: false, error: \"å‘é€å¤±è´¥\" };\r\n  }\r\n}\r\n\r\n// ==========================================\r\n// 7. æ–‡ç« ç³»ç»Ÿ (Articles)\r\n// ==========================================\r\n\r\nexport async function getArticles() {\r\n  const articles = await prisma.article.findMany({\r\n    orderBy: { createdAt: 'desc' }\r\n  });\r\n  return articles.map(a => ({\r\n    ...a,\r\n    createdAt: a.createdAt.toISOString()\r\n  }));\r\n}\r\n\r\nexport async function getArticleById(id: string) {\r\n  try {\r\n    const article = await prisma.article.findUnique({ where: { id } });\r\n    if (article) return { success: true, data: article };\r\n    return { success: false, error: \"æ–‡ç« æœªæ‰¾åˆ°\" };\r\n  } catch (error) {\r\n    return { success: false, error: \"æŸ¥è¯¢å¤±è´¥\" };\r\n  }\r\n}\r\n\r\nexport async function createArticle(data: any) {\r\n  await prisma.article.create({\r\n    data: {\r\n      ...data,\r\n      author: 'ç®¡ç†å‘˜',\r\n      views: 0,\r\n      image: \"https://images.unsplash.com/photo-1499209974431-2761eb43a768?w=800&q=80\"\r\n    }\r\n  });\r\n  revalidatePath(\"/student/articles\");\r\n  revalidatePath(\"/admin/content\");\r\n  return { success: true };\r\n}\r\n\r\nexport async function deleteArticle(id: string) {\r\n  try {\r\n    await prisma.article.delete({ where: { id } });\r\n    revalidatePath(\"/admin/content\");\r\n    revalidatePath(\"/student/articles\");\r\n    return { success: true };\r\n  } catch (error) {\r\n    return { success: false, error: \"åˆ é™¤å¤±è´¥\" };\r\n  }\r\n}\r\n\r\n// ==========================================\r\n// 8. ç³»ç»Ÿç®¡ç†ä¸çœ‹æ¿\r\n// ==========================================\r\n\r\nexport async function getAdminDashboardStats() {\r\n  try {\r\n    const [studentCount, appointmentCount, completedCount, rawChartData] = await Promise.all([\r\n      prisma.user.count({ where: { role: 'student' } }),\r\n      \r\n      // ç»Ÿè®¡æ‰€æœ‰é¢„çº¦ (åŒ…æ‹¬ç­‰å¾…ä¸­çš„ï¼Œç”¨äºæ˜¾ç¤ºçƒ­åº¦)\r\n      prisma.appointment.count(), \r\n\r\n      // ç»Ÿè®¡å·²å®Œæˆ\r\n      prisma.appointment.count({ where: { status: 'completed' } }),\r\n\r\n      // å›¾è¡¨æ•°æ® (ç»Ÿè®¡æœ€è¿‘7å¤©)\r\n      prisma.appointment.findMany({\r\n        where: {\r\n          date: { gte: new Date(new Date().setDate(new Date().getDate() - 6)) }\r\n        },\r\n        select: { date: true }\r\n      })\r\n    ]);\r\n\r\n    const completionRate = appointmentCount > 0 \r\n      ? Math.round((completedCount / appointmentCount) * 100) + \"%\" \r\n      : \"0%\";\r\n\r\n    const chartData = [];\r\n    const weekMap = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];\r\n\r\n    for (let i = 6; i >= 0; i--) {\r\n      const d = new Date();\r\n      d.setDate(d.getDate() - i);\r\n      const month = d.getMonth() + 1;\r\n      const day = d.getDate();\r\n      const dateKey = `${month}/${day}`;\r\n      const weekLabel = weekMap[d.getDay()];\r\n\r\n      const count = rawChartData.filter(apt => {\r\n        const aptDate = new Date(apt.date);\r\n        return aptDate.getDate() === day && aptDate.getMonth() + 1 === month;\r\n      }).length;\r\n\r\n      chartData.push({ name: dateKey, day: weekLabel, visits: count });\r\n    }\r\n\r\n    return {\r\n      success: true,\r\n      data: {\r\n        stats: {\r\n          students: studentCount,\r\n          appointments: appointmentCount,\r\n          crisis: 0, // æš‚æ— å±æœºé¢„è­¦é€»è¾‘\r\n          rate: completionRate\r\n        },\r\n        chart: chartData\r\n      }\r\n    };\r\n\r\n  } catch (error) {\r\n    console.error(\"çœ‹æ¿æ•°æ®åŠ è½½å¤±è´¥:\", error);\r\n    return { success: false, error: \"åŠ è½½å¤±è´¥\" };\r\n  }\r\n}\r\n\r\nexport async function getSystemSettings() {\r\n  try {\r\n    let config = await prisma.systemConfig.findFirst();\r\n    if (!config) {\r\n      config = await prisma.systemConfig.create({ data: {} });\r\n    }\r\n    return { success: true, data: config };\r\n  } catch (error) {\r\n    return { success: false, error: \"è·å–é…ç½®å¤±è´¥\" };\r\n  }\r\n}\r\n\r\nexport async function updateSystemSettings(data: any) {\r\n  try {\r\n    const first = await prisma.systemConfig.findFirst();\r\n    if (first) {\r\n      await prisma.systemConfig.update({\r\n        where: { id: first.id },\r\n        data: {\r\n          platformName: data.platformName,\r\n          hotline: data.hotline,\r\n          openHours: data.openHours,\r\n          maintenanceMode: data.maintenanceMode === 'true' || data.maintenanceMode === true\r\n        }\r\n      });\r\n      return { success: true };\r\n    }\r\n    return { success: false, error: \"æœªæ‰¾åˆ°é…ç½®è®°å½•\" };\r\n  } catch (error) {\r\n    return { success: false, error: \"ä¿å­˜å¤±è´¥\" };\r\n  }\r\n}\r\n\r\n// ä¿å­˜è‡ªåŠ©æµ‹è¯„ç»“æœ\r\nexport async function saveAssessment(studentId: string, score: number, result: string) {\r\n  try {\r\n    // æ³¨æ„ï¼šè¿™é‡Œä½¿ç”¨çš„æ˜¯ Assessment è¡¨ï¼Œä¸æ˜¯ TestResult è¡¨\r\n    await prisma.assessment.create({\r\n      data: {\r\n        studentId,\r\n        type: 'PHQ-9', // é»˜è®¤ç±»å‹\r\n        score,\r\n        result\r\n      }\r\n    });\r\n    revalidatePath(\"/student/assessment\");\r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error(\"ä¿å­˜æµ‹è¯„å¤±è´¥:\", error);\r\n    return { success: false, error: \"ä¿å­˜å¤±è´¥\" };\r\n  }\r\n}\r\n\r\n// è·å–å†å²æµ‹è¯„è®°å½• (ç”¨äºç”»å›¾)\r\nexport async function getAssessmentHistory(studentId: string) {\r\n  try {\r\n    const data = await prisma.assessment.findMany({\r\n      where: { studentId },\r\n      orderBy: { createdAt: 'asc' } // æŒ‰æ—¶é—´æ­£åºæ’åˆ—ï¼Œæ–¹ä¾¿å›¾è¡¨æ˜¾ç¤ºè¶‹åŠ¿\r\n    });\r\n    return data;\r\n  } catch (error) {\r\n    console.error(\"è·å–å†å²å¤±è´¥:\", error);\r\n    return [];\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;IA6gBsB,uBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 274, "column": 0}, "map": {"version":3,"sources":["file:///D:/%E8%BD%AF%E4%BB%B6%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E5%AE%9E%E9%AA%8C/my-counseling-app/app/student/assessment/page.tsx"],"sourcesContent":["\"use client\";\r\nimport { useState, useEffect } from 'react';\r\nimport { useAppStore } from '@/lib/store';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Progress } from '@/components/ui/progress';\r\nimport { Card } from '@/components/ui/card';\r\nimport { Alert, AlertTitle, AlertDescription } from '@/components/ui/alert';\r\nimport { LineChart, Line, XAxis, YAxis, Tooltip, ResponsiveContainer, CartesianGrid } from 'recharts';\r\nimport { Activity, AlertTriangle, CheckCircle2, Loader2 } from 'lucide-react';\r\nimport { toast } from 'sonner'; // âœ… å¼•å…¥æç¤ºç»„ä»¶\r\n// âœ… å¼•å…¥åç«¯ Actions\r\nimport { saveAssessment, getAssessmentHistory } from '@/app/actions';\r\n\r\nconst QUESTIONS = [\r\n  \"åšäº‹æ—¶æä¸èµ·åŠ²æˆ–æ²¡æœ‰å…´è¶£\",\r\n  \"æ„Ÿåˆ°å¿ƒæƒ…ä½è½ã€æ²®ä¸§æˆ–ç»æœ›\",\r\n  \"å…¥ç¡å›°éš¾ã€ç¡ä¸å®‰ç¨³æˆ–ç¡çœ è¿‡å¤š\",\r\n  \"æ„Ÿåˆ°ç–²å€¦æˆ–æ²¡æœ‰æ´»åŠ›\",\r\n  \"é£Ÿæ¬²ä¸æŒ¯æˆ–åƒå¤ªå¤š\",\r\n];\r\n\r\nexport default function AssessmentPage() {\r\n  const [step, setStep] = useState(0);\r\n  const [answers, setAnswers] = useState<number[]>([]);\r\n  const [result, setResult] = useState<number | null>(null);\r\n  \r\n  // âœ… æ”¹ç”¨ API æ•°æ®\r\n  const { currentUser } = useAppStore();\r\n  const [history, setHistory] = useState<any[]>([]);\r\n  const [loadingHistory, setLoadingHistory] = useState(true);\r\n\r\n  // âœ… åŠ è½½å†å²è®°å½• (å¸¦å®‰å…¨æ£€æŸ¥)\r\n  useEffect(() => {\r\n    async function fetchHistory() {\r\n      if (currentUser?.id) {\r\n        try {\r\n          const data = await getAssessmentHistory(currentUser.id);\r\n          // ğŸ›¡ï¸ åŒé‡ä¿é™©ï¼šç¡®ä¿æ˜¯æ•°ç»„ï¼Œå¦åˆ™ç»™ç©ºæ•°ç»„ï¼Œé˜²æ­¢å›¾è¡¨å´©æºƒ\r\n          if (Array.isArray(data)) {\r\n            setHistory(data);\r\n          } else {\r\n            setHistory([]);\r\n          }\r\n        } catch (error) {\r\n          console.error(\"åŠ è½½å†å²å¤±è´¥:\", error);\r\n          setHistory([]);\r\n        } finally {\r\n          setLoadingHistory(false);\r\n        }\r\n      }\r\n    }\r\n    fetchHistory();\r\n  }, [currentUser, result]); // å½“ result æ›´æ–°æ—¶ï¼ˆåˆšæµ‹å®Œï¼‰ï¼Œä¹Ÿåˆ·æ–°å†å²\r\n\r\n  const handleAnswer = async (score: number) => {\r\n    const newAnswers = [...answers, score];\r\n    \r\n    // å¦‚æœè¿˜æ²¡åˆ°æœ€åä¸€é¢˜\r\n    if (step < QUESTIONS.length - 1) {\r\n      setAnswers(newAnswers);\r\n      setStep(step + 1);\r\n    } else {\r\n      // æœ€åä¸€é¢˜ï¼Œè®¡ç®—ç»“æœå¹¶ä¿å­˜\r\n      const total = newAnswers.reduce((a, b) => a + b, 0);\r\n      setResult(total);\r\n      \r\n      // âœ… å­˜å…¥æ•°æ®åº“\r\n      if (currentUser?.id) {\r\n        try {\r\n          await saveAssessment(\r\n            currentUser.id,\r\n            total,\r\n            total > 10 ? 'éœ€å…³æ³¨' : 'æ­£å¸¸'\r\n          );\r\n          toast.success(\"æµ‹è¯„å®Œæˆ\", { description: \"ç»“æœå·²ä¿å­˜è‡³äº‘ç«¯æ¡£æ¡ˆ\" });\r\n        } catch (error) {\r\n          toast.error(\"ä¿å­˜å¤±è´¥\", { description: \"ç½‘ç»œè¿æ¥å¯èƒ½ä¸ç¨³å®š\" });\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  const isHighRisk = result !== null && result > 12;\r\n\r\n  return (\r\n    <div className=\"space-y-8 pb-10\">\r\n      <div className=\"flex flex-col md:flex-row justify-between items-end border-b border-gray-100 pb-4\">\r\n        <div>\r\n          <h1 className=\"text-2xl font-bold text-[#2C3E50] flex items-center gap-2\">\r\n            <Activity className=\"w-6 h-6 text-[#5D9C59]\" /> å¿ƒç†æµ‹è¯„ä¸­å¿ƒ\r\n          </h1>\r\n          <p className=\"text-slate-500 mt-1 text-sm\">ç§‘å­¦è¯„ä¼°æ‚¨çš„å¿ƒç†çŠ¶æ€ï¼Œæ•°æ®å·²åŠ å¯†å­˜å‚¨äºäº‘ç«¯</p>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n        {/* å·¦ä¾§ï¼šæµ‹è¯„åŒº */}\r\n        <div className=\"lg:col-span-2\">\r\n           <div className=\"bg-white rounded-2xl shadow-sm border border-slate-100 p-8 min-h-[400px] flex flex-col justify-center\">\r\n             {result === null ? (\r\n               <>\r\n                 <div className=\"mb-8\">\r\n                   <div className=\"flex justify-between text-sm font-medium text-slate-500 mb-2\">\r\n                     <span>è¿›åº¦</span>\r\n                     <span>{step + 1} / {QUESTIONS.length}</span>\r\n                   </div>\r\n                   <Progress value={(step / QUESTIONS.length) * 100} className=\"h-2 bg-slate-100\" />\r\n                 </div>\r\n                 <h2 className=\"text-2xl font-bold text-[#2C3E50] mb-8 leading-relaxed text-center\">\r\n                   â€œ åœ¨è¿‡å»çš„ä¸¤å‘¨é‡Œï¼Œæ‚¨æœ‰å¤šå°‘æ—¶é—´<br/>{QUESTIONS[step]}ï¼Ÿ â€\r\n                 </h2>\r\n                 <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                   {[0, 1, 2, 3].map((score) => (\r\n                     <button \r\n                       key={score} \r\n                       className=\"p-4 rounded-xl border-2 border-slate-100 hover:border-[#5D9C59] hover:bg-[#F0F7EF] hover:text-[#3E6D3B] transition-all text-left font-medium text-slate-600\"\r\n                       onClick={() => handleAnswer(score)}\r\n                     >\r\n                       {['å®Œå…¨ä¸ä¼š', 'åªæœ‰å‡ å¤©', 'ä¸€åŠä»¥ä¸Šæ—¶é—´', 'å‡ ä¹æ¯å¤©'][score]}\r\n                     </button>\r\n                   ))}\r\n                 </div>\r\n               </>\r\n             ) : (\r\n               <div className=\"text-center animate-in fade-in zoom-in duration-500\">\r\n                 <div className=\"w-20 h-20 mx-auto bg-[#F0F7EF] rounded-full flex items-center justify-center mb-6\">\r\n                   <CheckCircle2 className=\"w-10 h-10 text-[#5D9C59]\" />\r\n                 </div>\r\n                 <h2 className=\"text-3xl font-bold text-[#2C3E50] mb-2\">æµ‹è¯„å®Œæˆ</h2>\r\n                 <p className=\"text-slate-500 mb-8\">PHQ-9 æŠ‘éƒç—‡ç­›æŸ¥é‡è¡¨</p>\r\n                 <div className=\"bg-slate-50 p-6 rounded-xl max-w-md mx-auto mb-8\">\r\n                   <div className=\"text-sm text-slate-500 mb-1\">æ‚¨çš„å¾—åˆ†</div>\r\n                   <div className={`text-5xl font-bold ${isHighRisk ? 'text-red-500' : 'text-[#5D9C59]'}`}>{result}</div>\r\n                   <div className=\"mt-2 font-medium text-slate-700\">\r\n                     {isHighRisk ? \"æƒ…ç»ªæ³¢åŠ¨è¾ƒå¤§\" : \"å¿ƒç†çŠ¶æ€è‰¯å¥½\"}\r\n                   </div>\r\n                 </div>\r\n                 {isHighRisk && (\r\n                   <Alert variant=\"destructive\" className=\"bg-red-50 border-red-100 text-left mb-6 max-w-md mx-auto\">\r\n                     <AlertTriangle className=\"h-4 w-4\" />\r\n                     <AlertTitle>æ¸©é¦¨æç¤º</AlertTitle>\r\n                     <AlertDescription>ç³»ç»Ÿæ£€æµ‹åˆ°æ‚¨æœ€è¿‘å‹åŠ›å¯èƒ½è¾ƒå¤§ã€‚å»ºè®®æ‚¨é¢„çº¦å’¨è¯¢å¸ˆèŠèŠã€‚</AlertDescription>\r\n                   </Alert>\r\n                 )}\r\n                 <Button onClick={() => {setResult(null); setStep(0); setAnswers([])}} variant=\"outline\">è¿”å›é‡æµ‹</Button>\r\n               </div>\r\n             )}\r\n           </div>\r\n        </div>\r\n\r\n        {/* å³ä¾§ï¼šå†å²è¶‹åŠ¿å›¾ */}\r\n        <div className=\"space-y-6\">\r\n          <Card className=\"border-0 shadow-sm\">\r\n            <div className=\"p-6 border-b border-slate-50\"><h3 className=\"font-bold text-[#2C3E50]\">å†å²è¶‹åŠ¿</h3></div>\r\n            <div className=\"p-6\">\r\n              {loadingHistory ? (\r\n                <div className=\"h-[200px] flex items-center justify-center text-slate-400\">\r\n                  <Loader2 className=\"animate-spin w-6 h-6 mr-2\" /> åŠ è½½æ•°æ®ä¸­...\r\n                </div>\r\n              ) : history.length > 0 ? (\r\n                <div className=\"h-[200px] w-full\">\r\n                  <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                    <LineChart data={history}>\r\n                      <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"#E2E8F0\" />\r\n                      <XAxis \r\n                        dataKey=\"createdAt\" \r\n                        tickFormatter={(v) => new Date(v).toLocaleDateString(undefined, {month:'numeric', day:'numeric'})} \r\n                        tick={{fontSize: 10}} \r\n                        axisLine={false} \r\n                        tickLine={false} \r\n                      />\r\n                      <YAxis tick={{fontSize: 10}} axisLine={false} tickLine={false} />\r\n                      <Tooltip labelFormatter={(v) => new Date(v).toLocaleDateString()} />\r\n                      <Line type=\"monotone\" dataKey=\"score\" stroke=\"#5D9C59\" strokeWidth={3} dot={{r: 4, fill: '#5D9C59'}} />\r\n                    </LineChart>\r\n                  </ResponsiveContainer>\r\n                </div>\r\n              ) : (\r\n                <div className=\"h-[200px] flex flex-col items-center justify-center text-slate-400 text-sm\">\r\n                  <Activity className=\"w-8 h-8 mb-2 opacity-50\" />æš‚æ— å†å²æµ‹è¯„æ•°æ®\r\n                </div>\r\n              )}\r\n            </div>\r\n          </Card>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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"}}]
}