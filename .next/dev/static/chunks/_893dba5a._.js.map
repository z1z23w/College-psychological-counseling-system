{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/%E8%BD%AF%E4%BB%B6%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E5%AE%9E%E9%AA%8C/my-counseling-app/components/ui/card.tsx"],"sourcesContent":["import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Card({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card\"\n      className={cn(\n        \"bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-header\"\n      className={cn(\n        \"@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-title\"\n      className={cn(\"leading-none font-semibold\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardDescription({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-description\"\n      className={cn(\"text-muted-foreground text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardAction({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-action\"\n      className={cn(\n        \"col-start-2 row-span-2 row-start-1 self-start justify-self-end\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-content\"\n      className={cn(\"px-6\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-footer\"\n      className={cn(\"flex items-center px-6 [.border-t]:pt-6\", className)}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardAction,\n  CardDescription,\n  CardContent,\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAEA;;;AAEA,SAAS,KAAK,EAAE,SAAS,EAAE,GAAG,OAAoC;IAChE,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,qFACA;QAED,GAAG,KAAK;;;;;;AAGf;KAXS;AAaT,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,4JACA;QAED,GAAG,KAAK;;;;;;AAGf;MAXS;AAaT,SAAS,UAAU,EAAE,SAAS,EAAE,GAAG,OAAoC;IACrE,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EAAC,8BAA8B;QAC3C,GAAG,KAAK;;;;;;AAGf;MARS;AAUT,SAAS,gBAAgB,EAAE,SAAS,EAAE,GAAG,OAAoC;IAC3E,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGf;MARS;AAUT,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,kEACA;QAED,GAAG,KAAK;;;;;;AAGf;MAXS;AAaT,SAAS,YAAY,EAAE,SAAS,EAAE,GAAG,OAAoC;IACvE,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EAAC,QAAQ;QACrB,GAAG,KAAK;;;;;;AAGf;MARS;AAUT,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EAAC,2CAA2C;QACxD,GAAG,KAAK;;;;;;AAGf;MARS"}},
    {"offset": {"line": 124, "column": 0}, "map": {"version":3,"sources":["file:///D:/%E8%BD%AF%E4%BB%B6%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E5%AE%9E%E9%AA%8C/my-counseling-app/components/ui/badge.tsx"],"sourcesContent":["import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center justify-center rounded-full border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90\",\n        destructive:\n          \"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60\",\n        outline:\n          \"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nfunction Badge({\n  className,\n  variant,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"span\"> &\n  VariantProps<typeof badgeVariants> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"span\"\n\n  return (\n    <Comp\n      data-slot=\"badge\"\n      className={cn(badgeVariants({ variant }), className)}\n      {...props}\n    />\n  )\n}\n\nexport { Badge, badgeVariants }\n"],"names":[],"mappings":";;;;;;;AACA;AACA;AAEA;;;;;AAEA,MAAM,gBAAgB,IAAA,0KAAG,EACvB,oZACA;IACE,UAAU;QACR,SAAS;YACP,SACE;YACF,WACE;YACF,aACE;YACF,SACE;QACJ;IACF;IACA,iBAAiB;QACf,SAAS;IACX;AACF;AAGF,SAAS,MAAM,EACb,SAAS,EACT,OAAO,EACP,UAAU,KAAK,EACf,GAAG,OAEuD;IAC1D,MAAM,OAAO,UAAU,2KAAI,GAAG;IAE9B,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EAAC,cAAc;YAAE;QAAQ,IAAI;QACzC,GAAG,KAAK;;;;;;AAGf;KAhBS"}},
    {"offset": {"line": 176, "column": 0}, "map": {"version":3,"sources":["file:///D:/%E8%BD%AF%E4%BB%B6%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E5%AE%9E%E9%AA%8C/my-counseling-app/app/actions.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { prisma } from \"@/lib/db\";\r\nimport { revalidatePath } from \"next/cache\";\r\n\r\n// ==========================================\r\n// 1. ç”¨æˆ·ç®¡ç† (ç®¡ç†å‘˜ç”¨)\r\n// ==========================================\r\n\r\nexport async function getUsers() {\r\n  try {\r\n    const users = await prisma.user.findMany({\r\n      orderBy: { createdAt: 'desc' }\r\n    });\r\n    return { success: true, data: users };\r\n  } catch (error) {\r\n    console.error(\"è·å–ç”¨æˆ·å¤±è´¥:\", error);\r\n    return { success: false, data: [] };\r\n  }\r\n}\r\n\r\nexport async function createUser(formData: FormData) {\r\n  const name = formData.get(\"name\") as string;\r\n  const username = formData.get(\"username\") as string;\r\n  const role = formData.get(\"role\") as string;\r\n  const college = formData.get(\"college\") as string;\r\n\r\n  try {\r\n    await prisma.user.create({\r\n      data: {\r\n        name,\r\n        username,\r\n        role,\r\n        college,\r\n        password: \"123456\", // é»˜è®¤å¯†ç \r\n        avatar: `https://api.dicebear.com/7.x/avataaars/svg?seed=${name}`\r\n      },\r\n    });\r\n    revalidatePath(\"/admin/users\");\r\n    return { success: true };\r\n  } catch (error) {\r\n    return { success: false, error: \"åˆ›å»ºå¤±è´¥ï¼Œå­¦å·å¯èƒ½å·²å­˜åœ¨\" };\r\n  }\r\n}\r\n\r\nexport async function updateUser(id: string, formData: FormData) {\r\n  const name = formData.get(\"name\") as string;\r\n  const username = formData.get(\"username\") as string;\r\n  const role = formData.get(\"role\") as string;\r\n  const college = formData.get(\"college\") as string;\r\n\r\n  try {\r\n    await prisma.user.update({\r\n      where: { id },\r\n      data: { name, username, role, college },\r\n    });\r\n    revalidatePath(\"/admin/users\");\r\n    return { success: true };\r\n  } catch (error) {\r\n    return { success: false, error: \"æ›´æ–°å¤±è´¥ï¼Œå­¦å·å¯èƒ½å†²çª\" };\r\n  }\r\n}\r\n\r\nexport async function deleteUser(id: string) {\r\n  try {\r\n    await prisma.user.delete({ where: { id } });\r\n    revalidatePath(\"/admin/users\");\r\n    return { success: true };\r\n  } catch (error) {\r\n    return { success: false, error: \"åˆ é™¤å¤±è´¥\" };\r\n  }\r\n}\r\n\r\n// ==========================================\r\n// 2. è®¤è¯ä¸æŸ¥è¯¢ (é€šç”¨)\r\n// ==========================================\r\n\r\nexport async function loginAction(username: string, role: string) {\r\n  try {\r\n    const user = await prisma.user.findFirst({\r\n      where: { username, role }\r\n    });\r\n    if (!user) return { success: false, error: \"ç”¨æˆ·ä¸å­˜åœ¨æˆ–è§’è‰²é”™è¯¯\" };\r\n    \r\n    // è¿”å›ç”¨æˆ·ä¿¡æ¯ï¼ˆä¸å«å¯†ç ï¼‰\r\n    const { password, ...userInfo } = user;\r\n    return { success: true, data: userInfo };\r\n  } catch (error) {\r\n    return { success: false, error: \"æ•°æ®åº“è¿æ¥å¤±è´¥\" };\r\n  }\r\n}\r\n\r\nexport async function getCounselors() {\r\n  return await prisma.user.findMany({\r\n    where: { role: 'counselor' },\r\n    select: { id: true, name: true, college: true, avatar: true } // æ˜ç¡®é€‰æ‹©éœ€è¦çš„å­—æ®µ\r\n  });\r\n}\r\n\r\n// ==========================================\r\n// 3. é¢„çº¦ç³»ç»Ÿ (æ ¸å¿ƒä¸šåŠ¡)\r\n// ==========================================\r\n\r\n// âœ… ä¿®å¤ï¼šè·å–é¢„çº¦åˆ—è¡¨ (å»é™¤äº† email å­—æ®µ)\r\nexport async function getAppointments(userId: string, role: 'student' | 'counselor') {\r\n  const where = role === 'student' ? { studentId: userId } : { counselorId: userId };\r\n  \r\n  const data = await prisma.appointment.findMany({\r\n    where,\r\n    include: {\r\n      // âš ï¸ å…³é”®ä¿®æ”¹ï¼šUserè¡¨æ²¡æœ‰emailå­—æ®µï¼Œæ”¹æŸ¥ username(å­¦å·) å’Œ college\r\n      student: { select: { name: true, username: true, college: true, avatar: true } },\r\n      counselor: { select: { name: true, college: true, avatar: true } },\r\n      testResult: true, // è·å–å…³è”çš„æµ‹è¯„ç»“æœ\r\n    },\r\n    orderBy: { date: 'desc' }\r\n  });\r\n  return data;\r\n}\r\n\r\n// âœ… åˆ›å»ºå¸¦è¯¦ç»†æ¡£æ¡ˆçš„é¢„çº¦\r\nexport async function createAppointmentWithDetails(data: any) {\r\n  // æ£€æŸ¥æ—¶é—´å†²çª\r\n  const existing = await prisma.appointment.findFirst({\r\n    where: {\r\n      counselorId: data.counselorId,\r\n      date: new Date(data.date),\r\n      time: data.time,\r\n      status: 'confirmed' \r\n    }\r\n  });\r\n\r\n  if (existing) return { success: false, msg: \"è¯¥æ—¶æ®µå·²è¢«å ç”¨\" };\r\n\r\n  try {\r\n    await prisma.appointment.create({\r\n      data: {\r\n        studentId: data.studentId,\r\n        counselorId: data.counselorId,\r\n        date: new Date(data.date),\r\n        time: data.time,\r\n        // è¯¦ç»†ä¿¡æ¯\r\n        idCard: data.idCard,\r\n        studentIdNum: data.studentIdNum,\r\n        phone: data.phone,\r\n        college: data.college,\r\n        major: data.major,\r\n        grade: data.grade,\r\n        classInfo: data.classInfo,\r\n        mentalHistory: data.mentalHistory,\r\n        physicalState: data.physicalState,\r\n        problemType: data.problemType,\r\n        status: 'pending'\r\n      }\r\n    });\r\n\r\n    revalidatePath('/student/booking');\r\n    revalidatePath('/counselor/dashboard');\r\n    return { success: true };\r\n  } catch (e) {\r\n    console.error(e);\r\n    return { success: false, msg: \"é¢„çº¦åˆ›å»ºå¼‚å¸¸\" };\r\n  }\r\n}\r\n\r\n// æ›´æ–°é¢„çº¦çŠ¶æ€ (å®¡æ‰¹/æ‹’ç»/å®Œæˆ)\r\nexport async function updateAppointmentStatus(id: string, status: string) {\r\n  await prisma.appointment.update({\r\n    where: { id },\r\n    data: { status }\r\n  });\r\n  revalidatePath(\"/counselor/dashboard\");\r\n  revalidatePath(\"/student/booking\");\r\n  return { success: true };\r\n}\r\n\r\n// æ›´æ–°å’¨è¯¢è®°å½• (å’¨è¯¢å¸ˆå†™ç»“æ¡ˆè®°å½•)\r\nexport async function updateConsultationRecord(id: string, notes: string) {\r\n  try {\r\n    await prisma.appointment.update({\r\n      where: { id },\r\n      data: { \r\n        notes, \r\n        status: 'completed' \r\n      }\r\n    });\r\n    revalidatePath(\"/counselor/cases\");\r\n    return { success: true };\r\n  } catch (error) {\r\n    return { success: false, error: \"ä¿å­˜å¤±è´¥\" };\r\n  }\r\n}\r\n\r\n// ==========================================\r\n// 4. å¿ƒç†æµ‹è¯„ç³»ç»Ÿ (TestResult)\r\n// ==========================================\r\n\r\nexport async function submitPsychTest(appointmentId: string, answers: any) {\r\n  // 1. è®¡ç®—åˆ†æ•°\r\n  const calculateScore = (arr: number[]) => arr.reduce((a, b) => a + b, 0);\r\n  const sdsScore = calculateScore(answers.sds || []);\r\n  const sasScore = calculateScore(answers.sas || []);\r\n  const sesScore = calculateScore(answers.ses || []);\r\n\r\n  // 2. é¢„è­¦åˆ¤æ–­ (é˜ˆå€¼ > 60)\r\n  let isHighRisk = false;\r\n  \r\n  if (sdsScore > 60 || sasScore > 60) {\r\n    isHighRisk = true;\r\n  }\r\n\r\n  try {\r\n    // 3. ä¿å­˜æµ‹è¯„ç»“æœ\r\n    await prisma.testResult.create({\r\n      data: {\r\n        appointmentId,\r\n        rawAnswers: answers,\r\n        sdsScore,\r\n        sasScore,\r\n        sesScore\r\n      }\r\n    });\r\n\r\n    // 4. å¦‚æœæ˜¯é«˜é£é™©ï¼Œä»…åšæ ‡è®°\r\n    if (isHighRisk) {\r\n        // A. æ ‡è®°å½“å‰é¢„çº¦ä¸ºå±æœº\r\n        await prisma.appointment.update({\r\n            where: { id: appointmentId },\r\n            data: { isCrisis: true }\r\n        });\r\n\r\n        // B. æ ‡è®°å­¦ç”Ÿæ¡£æ¡ˆä¸ºçº¢è‰²é¢„è­¦\r\n        const currentApt = await prisma.appointment.findUnique({ where: { id: appointmentId } });\r\n        if (currentApt) {\r\n            await prisma.user.update({\r\n                where: { id: currentApt.studentId },\r\n                data: { riskLevel: 'red' }\r\n            });\r\n        }\r\n    }\r\n\r\n    revalidatePath('/student/booking');\r\n    revalidatePath('/counselor/dashboard');\r\n    \r\n    // âœ… ç§»é™¤è‡ªåŠ¨é¢„çº¦ä»£ç ï¼Œä»…è¿”å›é£é™©çŠ¶æ€\r\n    return { success: true, isHighRisk };\r\n\r\n  } catch (error) {\r\n    console.error(\"æµ‹è¯„æäº¤å¤±è´¥:\", error);\r\n    return { success: false, error: \"æäº¤å¤±è´¥\" };\r\n  }\r\n}\r\n\r\n// ==========================================\r\n// 5. æ’ç­ç³»ç»Ÿ (Schedule)\r\n// ==========================================\r\n\r\nexport async function getCounselorSchedule(counselorId: string) {\r\n  try {\r\n    const schedules = await prisma.schedule.findMany({\r\n      where: { counselorId, isAvailable: true }\r\n    });\r\n    return { success: true, data: schedules };\r\n  } catch (error) {\r\n    return { success: false, data: [] };\r\n  }\r\n}\r\n\r\nexport async function updateSchedule(counselorId: string, slots: any[]) {\r\n  try {\r\n    const ops = slots.map(slot => \r\n      prisma.schedule.upsert({\r\n        where: {\r\n          counselorId_dayOfWeek_timeSlot: {\r\n            counselorId,\r\n            dayOfWeek: slot.dayOfWeek,\r\n            timeSlot: slot.timeSlot\r\n          }\r\n        },\r\n        update: { isAvailable: slot.isAvailable },\r\n        create: {\r\n          counselorId,\r\n          dayOfWeek: slot.dayOfWeek,\r\n          timeSlot: slot.timeSlot,\r\n          isAvailable: slot.isAvailable\r\n        }\r\n      })\r\n    );\r\n    \r\n    await prisma.$transaction(ops);\r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error(error);\r\n    return { success: false, error: \"ä¿å­˜å¤±è´¥\" };\r\n  }\r\n}\r\n\r\n// ==========================================\r\n// 6. èŠå¤©ç³»ç»Ÿ (Messages)\r\n// ==========================================\r\n\r\nexport async function getChatContacts(currentUserId: string, role: string) {\r\n  try {\r\n    if (role === 'student') {\r\n      const counselors = await prisma.user.findMany({\r\n        where: { role: 'counselor' },\r\n        select: { id: true, name: true, avatar: true, college: true }\r\n      });\r\n      return { success: true, data: counselors };\r\n    } else {\r\n      const students = await prisma.user.findMany({\r\n        where: { role: 'student' },\r\n        select: { id: true, name: true, avatar: true, college: true }\r\n      });\r\n      return { success: true, data: students };\r\n    }\r\n  } catch (error) {\r\n    return { success: false, data: [] };\r\n  }\r\n}\r\n\r\nexport async function getMessages(userId1: string, userId2: string) {\r\n  try {\r\n    const messages = await prisma.message.findMany({\r\n      where: {\r\n        OR: [\r\n          { senderId: userId1, receiverId: userId2 },\r\n          { senderId: userId2, receiverId: userId1 }\r\n        ]\r\n      },\r\n      orderBy: { createdAt: 'asc' },\r\n      include: {\r\n        sender: { select: { name: true, avatar: true } }\r\n      }\r\n    });\r\n    return { success: true, data: messages };\r\n  } catch (error) {\r\n    return { success: false, data: [] };\r\n  }\r\n}\r\n\r\nexport async function sendMessage(senderId: string, receiverId: string, content: string) {\r\n  try {\r\n    const message = await prisma.message.create({\r\n      data: { senderId, receiverId, content }\r\n    });\r\n    return { success: true, data: message };\r\n  } catch (error) {\r\n    return { success: false, error: \"å‘é€å¤±è´¥\" };\r\n  }\r\n}\r\n\r\n// ==========================================\r\n// 7. æ–‡ç« ç³»ç»Ÿ (Articles)\r\n// ==========================================\r\n\r\nexport async function getArticles() {\r\n  const articles = await prisma.article.findMany({\r\n    orderBy: { createdAt: 'desc' }\r\n  });\r\n  return articles.map(a => ({\r\n    ...a,\r\n    createdAt: a.createdAt.toISOString()\r\n  }));\r\n}\r\n\r\nexport async function getArticleById(id: string) {\r\n  try {\r\n    const article = await prisma.article.findUnique({ where: { id } });\r\n    if (article) return { success: true, data: article };\r\n    return { success: false, error: \"æ–‡ç« æœªæ‰¾åˆ°\" };\r\n  } catch (error) {\r\n    return { success: false, error: \"æŸ¥è¯¢å¤±è´¥\" };\r\n  }\r\n}\r\n\r\nexport async function createArticle(data: any) {\r\n  await prisma.article.create({\r\n    data: {\r\n      ...data,\r\n      author: 'ç®¡ç†å‘˜',\r\n      views: 0,\r\n      image: \"https://images.unsplash.com/photo-1499209974431-2761eb43a768?w=800&q=80\"\r\n    }\r\n  });\r\n  revalidatePath(\"/student/articles\");\r\n  revalidatePath(\"/admin/content\");\r\n  return { success: true };\r\n}\r\n\r\nexport async function deleteArticle(id: string) {\r\n  try {\r\n    await prisma.article.delete({ where: { id } });\r\n    revalidatePath(\"/admin/content\");\r\n    revalidatePath(\"/student/articles\");\r\n    return { success: true };\r\n  } catch (error) {\r\n    return { success: false, error: \"åˆ é™¤å¤±è´¥\" };\r\n  }\r\n}\r\n\r\n// ==========================================\r\n// 8. ç³»ç»Ÿç®¡ç†ä¸çœ‹æ¿\r\n// ==========================================\r\n\r\nexport async function getAdminDashboardStats() {\r\n  try {\r\n    const [studentCount, appointmentCount, completedCount, rawChartData] = await Promise.all([\r\n      prisma.user.count({ where: { role: 'student' } }),\r\n      \r\n      // ç»Ÿè®¡æ‰€æœ‰é¢„çº¦ (åŒ…æ‹¬ç­‰å¾…ä¸­çš„ï¼Œç”¨äºæ˜¾ç¤ºçƒ­åº¦)\r\n      prisma.appointment.count(), \r\n\r\n      // ç»Ÿè®¡å·²å®Œæˆ\r\n      prisma.appointment.count({ where: { status: 'completed' } }),\r\n\r\n      // å›¾è¡¨æ•°æ® (ç»Ÿè®¡æœ€è¿‘7å¤©)\r\n      prisma.appointment.findMany({\r\n        where: {\r\n          date: { gte: new Date(new Date().setDate(new Date().getDate() - 6)) }\r\n        },\r\n        select: { date: true }\r\n      })\r\n    ]);\r\n\r\n    const completionRate = appointmentCount > 0 \r\n      ? Math.round((completedCount / appointmentCount) * 100) + \"%\" \r\n      : \"0%\";\r\n\r\n    const chartData = [];\r\n    const weekMap = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];\r\n\r\n    for (let i = 6; i >= 0; i--) {\r\n      const d = new Date();\r\n      d.setDate(d.getDate() - i);\r\n      const month = d.getMonth() + 1;\r\n      const day = d.getDate();\r\n      const dateKey = `${month}/${day}`;\r\n      const weekLabel = weekMap[d.getDay()];\r\n\r\n      const count = rawChartData.filter(apt => {\r\n        const aptDate = new Date(apt.date);\r\n        return aptDate.getDate() === day && aptDate.getMonth() + 1 === month;\r\n      }).length;\r\n\r\n      chartData.push({ name: dateKey, day: weekLabel, visits: count });\r\n    }\r\n\r\n    return {\r\n      success: true,\r\n      data: {\r\n        stats: {\r\n          students: studentCount,\r\n          appointments: appointmentCount,\r\n          crisis: 0, // æš‚æ— å±æœºé¢„è­¦é€»è¾‘\r\n          rate: completionRate\r\n        },\r\n        chart: chartData\r\n      }\r\n    };\r\n\r\n  } catch (error) {\r\n    console.error(\"çœ‹æ¿æ•°æ®åŠ è½½å¤±è´¥:\", error);\r\n    return { success: false, error: \"åŠ è½½å¤±è´¥\" };\r\n  }\r\n}\r\n\r\nexport async function getSystemSettings() {\r\n  try {\r\n    let config = await prisma.systemConfig.findFirst();\r\n    if (!config) {\r\n      config = await prisma.systemConfig.create({ data: {} });\r\n    }\r\n    return { success: true, data: config };\r\n  } catch (error) {\r\n    return { success: false, error: \"è·å–é…ç½®å¤±è´¥\" };\r\n  }\r\n}\r\n\r\nexport async function updateSystemSettings(data: any) {\r\n  try {\r\n    const first = await prisma.systemConfig.findFirst();\r\n    if (first) {\r\n      await prisma.systemConfig.update({\r\n        where: { id: first.id },\r\n        data: {\r\n          platformName: data.platformName,\r\n          hotline: data.hotline,\r\n          openHours: data.openHours,\r\n          maintenanceMode: data.maintenanceMode === 'true' || data.maintenanceMode === true\r\n        }\r\n      });\r\n      return { success: true };\r\n    }\r\n    return { success: false, error: \"æœªæ‰¾åˆ°é…ç½®è®°å½•\" };\r\n  } catch (error) {\r\n    return { success: false, error: \"ä¿å­˜å¤±è´¥\" };\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;;IAwGsB,kBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 191, "column": 0}, "map": {"version":3,"sources":["file:///D:/%E8%BD%AF%E4%BB%B6%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E5%AE%9E%E9%AA%8C/my-counseling-app/app/actions.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { prisma } from \"@/lib/db\";\r\nimport { revalidatePath } from \"next/cache\";\r\n\r\n// ==========================================\r\n// 1. ç”¨æˆ·ç®¡ç† (ç®¡ç†å‘˜ç”¨)\r\n// ==========================================\r\n\r\nexport async function getUsers() {\r\n  try {\r\n    const users = await prisma.user.findMany({\r\n      orderBy: { createdAt: 'desc' }\r\n    });\r\n    return { success: true, data: users };\r\n  } catch (error) {\r\n    console.error(\"è·å–ç”¨æˆ·å¤±è´¥:\", error);\r\n    return { success: false, data: [] };\r\n  }\r\n}\r\n\r\nexport async function createUser(formData: FormData) {\r\n  const name = formData.get(\"name\") as string;\r\n  const username = formData.get(\"username\") as string;\r\n  const role = formData.get(\"role\") as string;\r\n  const college = formData.get(\"college\") as string;\r\n\r\n  try {\r\n    await prisma.user.create({\r\n      data: {\r\n        name,\r\n        username,\r\n        role,\r\n        college,\r\n        password: \"123456\", // é»˜è®¤å¯†ç \r\n        avatar: `https://api.dicebear.com/7.x/avataaars/svg?seed=${name}`\r\n      },\r\n    });\r\n    revalidatePath(\"/admin/users\");\r\n    return { success: true };\r\n  } catch (error) {\r\n    return { success: false, error: \"åˆ›å»ºå¤±è´¥ï¼Œå­¦å·å¯èƒ½å·²å­˜åœ¨\" };\r\n  }\r\n}\r\n\r\nexport async function updateUser(id: string, formData: FormData) {\r\n  const name = formData.get(\"name\") as string;\r\n  const username = formData.get(\"username\") as string;\r\n  const role = formData.get(\"role\") as string;\r\n  const college = formData.get(\"college\") as string;\r\n\r\n  try {\r\n    await prisma.user.update({\r\n      where: { id },\r\n      data: { name, username, role, college },\r\n    });\r\n    revalidatePath(\"/admin/users\");\r\n    return { success: true };\r\n  } catch (error) {\r\n    return { success: false, error: \"æ›´æ–°å¤±è´¥ï¼Œå­¦å·å¯èƒ½å†²çª\" };\r\n  }\r\n}\r\n\r\nexport async function deleteUser(id: string) {\r\n  try {\r\n    await prisma.user.delete({ where: { id } });\r\n    revalidatePath(\"/admin/users\");\r\n    return { success: true };\r\n  } catch (error) {\r\n    return { success: false, error: \"åˆ é™¤å¤±è´¥\" };\r\n  }\r\n}\r\n\r\n// ==========================================\r\n// 2. è®¤è¯ä¸æŸ¥è¯¢ (é€šç”¨)\r\n// ==========================================\r\n\r\nexport async function loginAction(username: string, role: string) {\r\n  try {\r\n    const user = await prisma.user.findFirst({\r\n      where: { username, role }\r\n    });\r\n    if (!user) return { success: false, error: \"ç”¨æˆ·ä¸å­˜åœ¨æˆ–è§’è‰²é”™è¯¯\" };\r\n    \r\n    // è¿”å›ç”¨æˆ·ä¿¡æ¯ï¼ˆä¸å«å¯†ç ï¼‰\r\n    const { password, ...userInfo } = user;\r\n    return { success: true, data: userInfo };\r\n  } catch (error) {\r\n    return { success: false, error: \"æ•°æ®åº“è¿æ¥å¤±è´¥\" };\r\n  }\r\n}\r\n\r\nexport async function getCounselors() {\r\n  return await prisma.user.findMany({\r\n    where: { role: 'counselor' },\r\n    select: { id: true, name: true, college: true, avatar: true } // æ˜ç¡®é€‰æ‹©éœ€è¦çš„å­—æ®µ\r\n  });\r\n}\r\n\r\n// ==========================================\r\n// 3. é¢„çº¦ç³»ç»Ÿ (æ ¸å¿ƒä¸šåŠ¡)\r\n// ==========================================\r\n\r\n// âœ… ä¿®å¤ï¼šè·å–é¢„çº¦åˆ—è¡¨ (å»é™¤äº† email å­—æ®µ)\r\nexport async function getAppointments(userId: string, role: 'student' | 'counselor') {\r\n  const where = role === 'student' ? { studentId: userId } : { counselorId: userId };\r\n  \r\n  const data = await prisma.appointment.findMany({\r\n    where,\r\n    include: {\r\n      // âš ï¸ å…³é”®ä¿®æ”¹ï¼šUserè¡¨æ²¡æœ‰emailå­—æ®µï¼Œæ”¹æŸ¥ username(å­¦å·) å’Œ college\r\n      student: { select: { name: true, username: true, college: true, avatar: true } },\r\n      counselor: { select: { name: true, college: true, avatar: true } },\r\n      testResult: true, // è·å–å…³è”çš„æµ‹è¯„ç»“æœ\r\n    },\r\n    orderBy: { date: 'desc' }\r\n  });\r\n  return data;\r\n}\r\n\r\n// âœ… åˆ›å»ºå¸¦è¯¦ç»†æ¡£æ¡ˆçš„é¢„çº¦\r\nexport async function createAppointmentWithDetails(data: any) {\r\n  // æ£€æŸ¥æ—¶é—´å†²çª\r\n  const existing = await prisma.appointment.findFirst({\r\n    where: {\r\n      counselorId: data.counselorId,\r\n      date: new Date(data.date),\r\n      time: data.time,\r\n      status: 'confirmed' \r\n    }\r\n  });\r\n\r\n  if (existing) return { success: false, msg: \"è¯¥æ—¶æ®µå·²è¢«å ç”¨\" };\r\n\r\n  try {\r\n    await prisma.appointment.create({\r\n      data: {\r\n        studentId: data.studentId,\r\n        counselorId: data.counselorId,\r\n        date: new Date(data.date),\r\n        time: data.time,\r\n        // è¯¦ç»†ä¿¡æ¯\r\n        idCard: data.idCard,\r\n        studentIdNum: data.studentIdNum,\r\n        phone: data.phone,\r\n        college: data.college,\r\n        major: data.major,\r\n        grade: data.grade,\r\n        classInfo: data.classInfo,\r\n        mentalHistory: data.mentalHistory,\r\n        physicalState: data.physicalState,\r\n        problemType: data.problemType,\r\n        status: 'pending'\r\n      }\r\n    });\r\n\r\n    revalidatePath('/student/booking');\r\n    revalidatePath('/counselor/dashboard');\r\n    return { success: true };\r\n  } catch (e) {\r\n    console.error(e);\r\n    return { success: false, msg: \"é¢„çº¦åˆ›å»ºå¼‚å¸¸\" };\r\n  }\r\n}\r\n\r\n// æ›´æ–°é¢„çº¦çŠ¶æ€ (å®¡æ‰¹/æ‹’ç»/å®Œæˆ)\r\nexport async function updateAppointmentStatus(id: string, status: string) {\r\n  await prisma.appointment.update({\r\n    where: { id },\r\n    data: { status }\r\n  });\r\n  revalidatePath(\"/counselor/dashboard\");\r\n  revalidatePath(\"/student/booking\");\r\n  return { success: true };\r\n}\r\n\r\n// æ›´æ–°å’¨è¯¢è®°å½• (å’¨è¯¢å¸ˆå†™ç»“æ¡ˆè®°å½•)\r\nexport async function updateConsultationRecord(id: string, notes: string) {\r\n  try {\r\n    await prisma.appointment.update({\r\n      where: { id },\r\n      data: { \r\n        notes, \r\n        status: 'completed' \r\n      }\r\n    });\r\n    revalidatePath(\"/counselor/cases\");\r\n    return { success: true };\r\n  } catch (error) {\r\n    return { success: false, error: \"ä¿å­˜å¤±è´¥\" };\r\n  }\r\n}\r\n\r\n// ==========================================\r\n// 4. å¿ƒç†æµ‹è¯„ç³»ç»Ÿ (TestResult)\r\n// ==========================================\r\n\r\nexport async function submitPsychTest(appointmentId: string, answers: any) {\r\n  // 1. è®¡ç®—åˆ†æ•°\r\n  const calculateScore = (arr: number[]) => arr.reduce((a, b) => a + b, 0);\r\n  const sdsScore = calculateScore(answers.sds || []);\r\n  const sasScore = calculateScore(answers.sas || []);\r\n  const sesScore = calculateScore(answers.ses || []);\r\n\r\n  // 2. é¢„è­¦åˆ¤æ–­ (é˜ˆå€¼ > 60)\r\n  let isHighRisk = false;\r\n  \r\n  if (sdsScore > 60 || sasScore > 60) {\r\n    isHighRisk = true;\r\n  }\r\n\r\n  try {\r\n    // 3. ä¿å­˜æµ‹è¯„ç»“æœ\r\n    await prisma.testResult.create({\r\n      data: {\r\n        appointmentId,\r\n        rawAnswers: answers,\r\n        sdsScore,\r\n        sasScore,\r\n        sesScore\r\n      }\r\n    });\r\n\r\n    // 4. å¦‚æœæ˜¯é«˜é£é™©ï¼Œä»…åšæ ‡è®°\r\n    if (isHighRisk) {\r\n        // A. æ ‡è®°å½“å‰é¢„çº¦ä¸ºå±æœº\r\n        await prisma.appointment.update({\r\n            where: { id: appointmentId },\r\n            data: { isCrisis: true }\r\n        });\r\n\r\n        // B. æ ‡è®°å­¦ç”Ÿæ¡£æ¡ˆä¸ºçº¢è‰²é¢„è­¦\r\n        const currentApt = await prisma.appointment.findUnique({ where: { id: appointmentId } });\r\n        if (currentApt) {\r\n            await prisma.user.update({\r\n                where: { id: currentApt.studentId },\r\n                data: { riskLevel: 'red' }\r\n            });\r\n        }\r\n    }\r\n\r\n    revalidatePath('/student/booking');\r\n    revalidatePath('/counselor/dashboard');\r\n    \r\n    // âœ… ç§»é™¤è‡ªåŠ¨é¢„çº¦ä»£ç ï¼Œä»…è¿”å›é£é™©çŠ¶æ€\r\n    return { success: true, isHighRisk };\r\n\r\n  } catch (error) {\r\n    console.error(\"æµ‹è¯„æäº¤å¤±è´¥:\", error);\r\n    return { success: false, error: \"æäº¤å¤±è´¥\" };\r\n  }\r\n}\r\n\r\n// ==========================================\r\n// 5. æ’ç­ç³»ç»Ÿ (Schedule)\r\n// ==========================================\r\n\r\nexport async function getCounselorSchedule(counselorId: string) {\r\n  try {\r\n    const schedules = await prisma.schedule.findMany({\r\n      where: { counselorId, isAvailable: true }\r\n    });\r\n    return { success: true, data: schedules };\r\n  } catch (error) {\r\n    return { success: false, data: [] };\r\n  }\r\n}\r\n\r\nexport async function updateSchedule(counselorId: string, slots: any[]) {\r\n  try {\r\n    const ops = slots.map(slot => \r\n      prisma.schedule.upsert({\r\n        where: {\r\n          counselorId_dayOfWeek_timeSlot: {\r\n            counselorId,\r\n            dayOfWeek: slot.dayOfWeek,\r\n            timeSlot: slot.timeSlot\r\n          }\r\n        },\r\n        update: { isAvailable: slot.isAvailable },\r\n        create: {\r\n          counselorId,\r\n          dayOfWeek: slot.dayOfWeek,\r\n          timeSlot: slot.timeSlot,\r\n          isAvailable: slot.isAvailable\r\n        }\r\n      })\r\n    );\r\n    \r\n    await prisma.$transaction(ops);\r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error(error);\r\n    return { success: false, error: \"ä¿å­˜å¤±è´¥\" };\r\n  }\r\n}\r\n\r\n// ==========================================\r\n// 6. èŠå¤©ç³»ç»Ÿ (Messages)\r\n// ==========================================\r\n\r\nexport async function getChatContacts(currentUserId: string, role: string) {\r\n  try {\r\n    if (role === 'student') {\r\n      const counselors = await prisma.user.findMany({\r\n        where: { role: 'counselor' },\r\n        select: { id: true, name: true, avatar: true, college: true }\r\n      });\r\n      return { success: true, data: counselors };\r\n    } else {\r\n      const students = await prisma.user.findMany({\r\n        where: { role: 'student' },\r\n        select: { id: true, name: true, avatar: true, college: true }\r\n      });\r\n      return { success: true, data: students };\r\n    }\r\n  } catch (error) {\r\n    return { success: false, data: [] };\r\n  }\r\n}\r\n\r\nexport async function getMessages(userId1: string, userId2: string) {\r\n  try {\r\n    const messages = await prisma.message.findMany({\r\n      where: {\r\n        OR: [\r\n          { senderId: userId1, receiverId: userId2 },\r\n          { senderId: userId2, receiverId: userId1 }\r\n        ]\r\n      },\r\n      orderBy: { createdAt: 'asc' },\r\n      include: {\r\n        sender: { select: { name: true, avatar: true } }\r\n      }\r\n    });\r\n    return { success: true, data: messages };\r\n  } catch (error) {\r\n    return { success: false, data: [] };\r\n  }\r\n}\r\n\r\nexport async function sendMessage(senderId: string, receiverId: string, content: string) {\r\n  try {\r\n    const message = await prisma.message.create({\r\n      data: { senderId, receiverId, content }\r\n    });\r\n    return { success: true, data: message };\r\n  } catch (error) {\r\n    return { success: false, error: \"å‘é€å¤±è´¥\" };\r\n  }\r\n}\r\n\r\n// ==========================================\r\n// 7. æ–‡ç« ç³»ç»Ÿ (Articles)\r\n// ==========================================\r\n\r\nexport async function getArticles() {\r\n  const articles = await prisma.article.findMany({\r\n    orderBy: { createdAt: 'desc' }\r\n  });\r\n  return articles.map(a => ({\r\n    ...a,\r\n    createdAt: a.createdAt.toISOString()\r\n  }));\r\n}\r\n\r\nexport async function getArticleById(id: string) {\r\n  try {\r\n    const article = await prisma.article.findUnique({ where: { id } });\r\n    if (article) return { success: true, data: article };\r\n    return { success: false, error: \"æ–‡ç« æœªæ‰¾åˆ°\" };\r\n  } catch (error) {\r\n    return { success: false, error: \"æŸ¥è¯¢å¤±è´¥\" };\r\n  }\r\n}\r\n\r\nexport async function createArticle(data: any) {\r\n  await prisma.article.create({\r\n    data: {\r\n      ...data,\r\n      author: 'ç®¡ç†å‘˜',\r\n      views: 0,\r\n      image: \"https://images.unsplash.com/photo-1499209974431-2761eb43a768?w=800&q=80\"\r\n    }\r\n  });\r\n  revalidatePath(\"/student/articles\");\r\n  revalidatePath(\"/admin/content\");\r\n  return { success: true };\r\n}\r\n\r\nexport async function deleteArticle(id: string) {\r\n  try {\r\n    await prisma.article.delete({ where: { id } });\r\n    revalidatePath(\"/admin/content\");\r\n    revalidatePath(\"/student/articles\");\r\n    return { success: true };\r\n  } catch (error) {\r\n    return { success: false, error: \"åˆ é™¤å¤±è´¥\" };\r\n  }\r\n}\r\n\r\n// ==========================================\r\n// 8. ç³»ç»Ÿç®¡ç†ä¸çœ‹æ¿\r\n// ==========================================\r\n\r\nexport async function getAdminDashboardStats() {\r\n  try {\r\n    const [studentCount, appointmentCount, completedCount, rawChartData] = await Promise.all([\r\n      prisma.user.count({ where: { role: 'student' } }),\r\n      \r\n      // ç»Ÿè®¡æ‰€æœ‰é¢„çº¦ (åŒ…æ‹¬ç­‰å¾…ä¸­çš„ï¼Œç”¨äºæ˜¾ç¤ºçƒ­åº¦)\r\n      prisma.appointment.count(), \r\n\r\n      // ç»Ÿè®¡å·²å®Œæˆ\r\n      prisma.appointment.count({ where: { status: 'completed' } }),\r\n\r\n      // å›¾è¡¨æ•°æ® (ç»Ÿè®¡æœ€è¿‘7å¤©)\r\n      prisma.appointment.findMany({\r\n        where: {\r\n          date: { gte: new Date(new Date().setDate(new Date().getDate() - 6)) }\r\n        },\r\n        select: { date: true }\r\n      })\r\n    ]);\r\n\r\n    const completionRate = appointmentCount > 0 \r\n      ? Math.round((completedCount / appointmentCount) * 100) + \"%\" \r\n      : \"0%\";\r\n\r\n    const chartData = [];\r\n    const weekMap = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];\r\n\r\n    for (let i = 6; i >= 0; i--) {\r\n      const d = new Date();\r\n      d.setDate(d.getDate() - i);\r\n      const month = d.getMonth() + 1;\r\n      const day = d.getDate();\r\n      const dateKey = `${month}/${day}`;\r\n      const weekLabel = weekMap[d.getDay()];\r\n\r\n      const count = rawChartData.filter(apt => {\r\n        const aptDate = new Date(apt.date);\r\n        return aptDate.getDate() === day && aptDate.getMonth() + 1 === month;\r\n      }).length;\r\n\r\n      chartData.push({ name: dateKey, day: weekLabel, visits: count });\r\n    }\r\n\r\n    return {\r\n      success: true,\r\n      data: {\r\n        stats: {\r\n          students: studentCount,\r\n          appointments: appointmentCount,\r\n          crisis: 0, // æš‚æ— å±æœºé¢„è­¦é€»è¾‘\r\n          rate: completionRate\r\n        },\r\n        chart: chartData\r\n      }\r\n    };\r\n\r\n  } catch (error) {\r\n    console.error(\"çœ‹æ¿æ•°æ®åŠ è½½å¤±è´¥:\", error);\r\n    return { success: false, error: \"åŠ è½½å¤±è´¥\" };\r\n  }\r\n}\r\n\r\nexport async function getSystemSettings() {\r\n  try {\r\n    let config = await prisma.systemConfig.findFirst();\r\n    if (!config) {\r\n      config = await prisma.systemConfig.create({ data: {} });\r\n    }\r\n    return { success: true, data: config };\r\n  } catch (error) {\r\n    return { success: false, error: \"è·å–é…ç½®å¤±è´¥\" };\r\n  }\r\n}\r\n\r\nexport async function updateSystemSettings(data: any) {\r\n  try {\r\n    const first = await prisma.systemConfig.findFirst();\r\n    if (first) {\r\n      await prisma.systemConfig.update({\r\n        where: { id: first.id },\r\n        data: {\r\n          platformName: data.platformName,\r\n          hotline: data.hotline,\r\n          openHours: data.openHours,\r\n          maintenanceMode: data.maintenanceMode === 'true' || data.maintenanceMode === true\r\n        }\r\n      });\r\n      return { success: true };\r\n    }\r\n    return { success: false, error: \"æœªæ‰¾åˆ°é…ç½®è®°å½•\" };\r\n  } catch (error) {\r\n    return { success: false, error: \"ä¿å­˜å¤±è´¥\" };\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;;IAoWsB,cAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 206, "column": 0}, "map": {"version":3,"sources":["file:///D:/%E8%BD%AF%E4%BB%B6%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E5%AE%9E%E9%AA%8C/my-counseling-app/app/student/dashboard/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport Link from 'next/link';\r\nimport { useAppStore } from '@/lib/store';\r\nimport { Card, CardContent } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Badge } from '@/components/ui/badge';\r\n// âœ… 1. æ–°å¢ Bot å›¾æ ‡å¼•ç”¨\r\nimport { CalendarDays, BookOpen, Activity, Clock, User, Bot } from 'lucide-react';\r\nimport { getAppointments, getArticles } from '@/app/actions';\r\n\r\nexport default function StudentDashboard() {\r\n  const { currentUser } = useAppStore();\r\n  \r\n  const [appointments, setAppointments] = useState<any[]>([]);\r\n  const [articles, setArticles] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  // è¿›é¡µé¢åŠ è½½æ•°æ®\r\n  useEffect(() => {\r\n    async function loadData() {\r\n      if (currentUser?.id) {\r\n        try {\r\n          // å¹¶è¡Œè¯·æ±‚æ•°æ®\r\n          const [apptData, artData] = await Promise.all([\r\n            getAppointments(currentUser.id, 'student'),\r\n            getArticles()\r\n          ]);\r\n          \r\n          setAppointments(apptData || []); \r\n          setArticles(artData || []);\r\n        } catch (error) {\r\n          console.error(\"æ•°æ®åŠ è½½å¤±è´¥\", error);\r\n        } finally {\r\n          setLoading(false);\r\n        }\r\n      }\r\n    }\r\n    loadData();\r\n  }, [currentUser]);\r\n\r\n  // è®¡ç®—å³å°†åˆ°æ¥çš„é¢„çº¦\r\n  const upcomingAppointments = appointments.filter(apt => \r\n    apt.status === 'confirmed' || apt.status === 'pending'\r\n  );\r\n\r\n  return (\r\n    <div className=\"space-y-8\">\r\n      {/* æ¬¢è¿å¤´éƒ¨ */}\r\n      <div className=\"flex justify-between items-end border-b border-gray-100 pb-6\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold text-[#2C3E50]\">\r\n            æ—©å®‰ï¼Œ{currentUser?.name || 'åŒå­¦'} ğŸ‘‹\r\n          </h1>\r\n          <p className=\"text-slate-500 mt-2\">ä»Šå¤©æ˜¯ {new Date().toLocaleDateString()}ï¼Œç¥ä½ æ‹¥æœ‰ç¾å¥½çš„ä¸€å¤©ã€‚</p>\r\n        </div>\r\n        <Link href=\"/student/booking\">\r\n          <Button className=\"bg-[#5D9C59] hover:bg-[#3E6D3B] text-white shadow-md\">\r\n            + å‘èµ·æ–°é¢„çº¦\r\n          </Button>\r\n        </Link>\r\n      </div>\r\n\r\n      {/* å¿«æ·å…¥å£å¡ç‰‡åŒºåŸŸ */}\r\n      {/* âœ… 2. ä¿®æ”¹å¸ƒå±€ï¼šé€‚é… 4 ä¸ªå¡ç‰‡ (å¤§å±æ˜¾ç¤º4åˆ—ï¼Œä¸­å±æ˜¾ç¤º2åˆ—) */}\r\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6\">\r\n        \r\n        {/* å¡ç‰‡1: å¿ƒç†å’¨è¯¢ */}\r\n        <Link href=\"/student/booking\">\r\n          <Card className=\"hover:shadow-lg transition-all cursor-pointer border-t-4 border-t-[#5D9C59] group h-full\">\r\n            <CardContent className=\"p-6 flex items-center gap-4\">\r\n              <div className=\"w-12 h-12 rounded-full bg-[#F0F7EF] flex items-center justify-center text-[#5D9C59] group-hover:bg-[#5D9C59] group-hover:text-white transition-colors\">\r\n                <CalendarDays className=\"w-6 h-6\" />\r\n              </div>\r\n              <div>\r\n                <h3 className=\"font-bold text-lg text-[#2C3E50]\">å¿ƒç†å’¨è¯¢</h3>\r\n                <p className=\"text-sm text-slate-500\">é¢„çº¦ä¸“ä¸šå’¨è¯¢å¸ˆ</p>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        </Link>\r\n\r\n        {/* âœ… 3. æ–°å¢å¡ç‰‡: AI å¿ƒç†åŠ©æ‰‹ */}\r\n        <Link href=\"/student/ai-companion\">\r\n          <Card className=\"hover:shadow-lg transition-all cursor-pointer border-t-4 border-t-purple-500 group h-full\">\r\n            <CardContent className=\"p-6 flex items-center gap-4\">\r\n              <div className=\"w-12 h-12 rounded-full bg-purple-50 flex items-center justify-center text-purple-600 group-hover:bg-purple-600 group-hover:text-white transition-colors\">\r\n                <Bot className=\"w-6 h-6\" />\r\n              </div>\r\n              <div>\r\n                <h3 className=\"font-bold text-lg text-[#2C3E50]\">AI å¿ƒç†åŠ©æ‰‹</h3>\r\n                <p className=\"text-sm text-slate-500\">24h æ™ºèƒ½é™ªä¼´</p>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        </Link>\r\n\r\n        {/* å¡ç‰‡3: å¿ƒç†æµ‹è¯„ */}\r\n        <Link href=\"/student/assessment\">\r\n          <Card className=\"hover:shadow-lg transition-all cursor-pointer border-t-4 border-t-blue-500 group h-full\">\r\n            <CardContent className=\"p-6 flex items-center gap-4\">\r\n              <div className=\"w-12 h-12 rounded-full bg-blue-50 flex items-center justify-center text-blue-500 group-hover:bg-blue-500 group-hover:text-white transition-colors\">\r\n                <Activity className=\"w-6 h-6\" />\r\n              </div>\r\n              <div>\r\n                <h3 className=\"font-bold text-lg text-[#2C3E50]\">å¿ƒç†æµ‹è¯„</h3>\r\n                <p className=\"text-sm text-slate-500\">äº†è§£å½“ä¸‹çŠ¶æ€</p>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        </Link>\r\n\r\n        {/* å¡ç‰‡4: çŸ¥è¯†åº“ */}\r\n        <Link href=\"/student/articles\">\r\n          <Card className=\"hover:shadow-lg transition-all cursor-pointer border-t-4 border-t-orange-500 group h-full\">\r\n            <CardContent className=\"p-6 flex items-center gap-4\">\r\n              <div className=\"w-12 h-12 rounded-full bg-orange-50 flex items-center justify-center text-orange-500 group-hover:bg-orange-500 group-hover:text-white transition-colors\">\r\n                <BookOpen className=\"w-6 h-6\" />\r\n              </div>\r\n              <div>\r\n                <h3 className=\"font-bold text-lg text-[#2C3E50]\">çŸ¥è¯†åº“</h3>\r\n                <p className=\"text-sm text-slate-500\">é˜…è¯»è‡ªåŠ©æ–‡ç« </p>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        </Link>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n        {/* å·¦ä¾§ï¼šæˆ‘çš„é¢„çº¦ */}\r\n        <div className=\"lg:col-span-2 space-y-6\">\r\n          <div className=\"flex justify-between items-center\">\r\n            <h2 className=\"text-xl font-bold text-[#2C3E50] flex items-center gap-2\">\r\n              <Clock className=\"w-5 h-5 text-[#5D9C59]\" /> æˆ‘çš„é¢„çº¦\r\n            </h2>\r\n            <Link href=\"/student/booking\" className=\"text-sm text-[#5D9C59] hover:underline\">æŸ¥çœ‹å…¨éƒ¨</Link>\r\n          </div>\r\n\r\n          <div className=\"space-y-4\">\r\n            {loading ? (\r\n               <div className=\"text-center py-10 text-slate-400\">æ•°æ®åŠ è½½ä¸­...</div>\r\n            ) : upcomingAppointments.length > 0 ? (\r\n              upcomingAppointments.map((apt) => (\r\n                <div key={apt.id} className=\"bg-white p-5 rounded-xl border border-slate-100 shadow-sm flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4\">\r\n                  <div className=\"flex items-center gap-4\">\r\n                    <div className=\"w-12 h-12 bg-slate-100 rounded-full flex items-center justify-center\">\r\n                       <User className=\"text-slate-400 w-6 h-6\" />\r\n                    </div>\r\n                    <div>\r\n                      <h4 className=\"font-bold text-[#2C3E50]\">{apt.counselor.name} è€å¸ˆ</h4>\r\n                      <div className=\"flex items-center gap-2 text-sm text-slate-500 mt-1\">\r\n                        <CalendarDays className=\"w-3 h-3\" />\r\n                        <span>{new Date(apt.date).toLocaleDateString()}</span>\r\n                        <span className=\"w-1 h-1 bg-slate-300 rounded-full\"></span>\r\n                        <span>{apt.time}</span>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  <Badge variant={apt.status === 'confirmed' ? 'default' : 'secondary'} \r\n                    className={apt.status === 'confirmed' ? \"bg-[#5D9C59]\" : \"bg-orange-100 text-orange-600 hover:bg-orange-100\"}>\r\n                    {apt.status === 'confirmed' ? 'é¢„çº¦æˆåŠŸ' : 'ç­‰å¾…ç¡®è®¤'}\r\n                  </Badge>\r\n                </div>\r\n              ))\r\n            ) : (\r\n              <div className=\"bg-slate-50 rounded-xl p-8 text-center border border-dashed border-slate-200\">\r\n                <p className=\"text-slate-500 mb-4\">æš‚æ— å¾…è¿›è¡Œçš„é¢„çº¦</p>\r\n                <Link href=\"/student/booking\">\r\n                  <Button variant=\"outline\">å»é¢„çº¦</Button>\r\n                </Link>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* å³ä¾§ï¼šæ¨èé˜…è¯» */}\r\n        <div className=\"space-y-6\">\r\n          <div className=\"flex justify-between items-center\">\r\n            <h2 className=\"text-xl font-bold text-[#2C3E50] flex items-center gap-2\">\r\n              <BookOpen className=\"w-5 h-5 text-orange-500\" /> æ¨èé˜…è¯»\r\n            </h2>\r\n            <Link href=\"/student/articles\" className=\"text-sm text-slate-400 hover:text-slate-600\">æ›´å¤š</Link>\r\n          </div>\r\n\r\n          <div className=\"space-y-4\">\r\n            {articles.slice(0, 3).map((article) => (\r\n              <Link href=\"/student/articles\" key={article.id}>\r\n                <div className=\"group bg-white p-4 rounded-xl border border-slate-100 shadow-sm hover:shadow-md transition-all cursor-pointer\">\r\n                  <div className=\"flex gap-4\">\r\n                    <div className=\"w-20 h-20 bg-slate-100 rounded-lg overflow-hidden flex-shrink-0\">\r\n                      <img src={article.image || \"https://images.unsplash.com/photo-1499209974431-2761eb43a768?w=800&q=80\"} alt=\"\" className=\"w-full h-full object-cover\" />\r\n                    </div>\r\n                    <div className=\"flex-1\">\r\n                      <Badge variant=\"secondary\" className=\"mb-2 text-xs bg-[#F0F7EF] text-[#3E6D3B] hover:bg-[#F0F7EF] border-0\">\r\n                        {article.category}\r\n                      </Badge>\r\n                      <h4 className=\"font-bold text-[#2C3E50] text-sm line-clamp-2 group-hover:text-[#5D9C59] transition-colors\">\r\n                        {article.title}\r\n                      </h4>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </Link>\r\n            ))}\r\n            {articles.length === 0 && !loading && (\r\n              <div className=\"text-center text-slate-400 text-sm py-4\">æš‚æ— æ¨èæ–‡ç« </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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"}}]
}